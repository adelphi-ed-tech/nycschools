<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2. Merges &amp; Joins &mdash; NYC Schools Open Data 0.1.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Graphs &amp; Charts" href="../03-Graphs-and-Charts/index.html" />
    <link rel="prev" title="1. Groups &amp; Aggregates" href="01-group-and-agg.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> NYC Schools Open Data
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../01-Basics/index.html">Data Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html">Combining Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03-Graphs-and-Charts/index.html">Graphs &amp; Charts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../04-Statistics/index.html">Statistics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../05-Maps-and-GIS/index.html">Maps &amp; GIS</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../data-sources.html">Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/nycschools.html">API Docs</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">NYC Schools Open Data</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Combining Data</a></li>
      <li class="breadcrumb-item active"><span class="section-number">2. </span>Merges &amp; Joins</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/nb/02-Combining-Data/02-merge-and-join.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars and line breaks on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
    white-space: pre;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="Merges-&amp;-Joins">
<h1><span class="section-number">2. </span>Merges &amp; Joins<a class="headerlink" href="#Merges-&-Joins" title="Permalink to this heading"></a></h1>
<p>Here, finally, we combine data sets together. I say finally because this is one of the <em>first</em> things you will do when working with real world data. <code class="docutils literal notranslate"><span class="pre">nycschools</span></code> has already combined multiple data sets into its core DataFrames, but you will want to combine this data in new ways, make new DataFrames from your results, and pull in new data from the outside world.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">nycschools</span> <span class="kn">import</span> <span class="n">schools</span><span class="p">,</span> <span class="n">exams</span>

<span class="c1"># school demographics in one frame</span>
<span class="n">demo</span> <span class="o">=</span> <span class="n">schools</span><span class="o">.</span><span class="n">load_school_demographics</span><span class="p">()</span>

<span class="c1"># exam results in another frame</span>
<span class="n">ela</span> <span class="o">=</span> <span class="n">exams</span><span class="o">.</span><span class="n">load_ela</span><span class="p">()</span>
<span class="n">math</span> <span class="o">=</span> <span class="n">exams</span><span class="o">.</span><span class="n">load_math</span><span class="p">()</span>
<br/></pre></div>
</div>
</div>
<section id="Merging-Data">
<h2><span class="section-number">2.1. </span>Merging Data<a class="headerlink" href="#Merging-Data" title="Permalink to this heading"></a></h2>
<p>When two data sets have a shared key then combining them into a single dataframe is straightforward. Here we use the <code class="docutils literal notranslate"><span class="pre">merge()</span></code> function in <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> to combine the school demographcs and ela test results into a single data frame. We merge them “on” the <code class="docutils literal notranslate"><span class="pre">dbn</span></code> and <code class="docutils literal notranslate"><span class="pre">ay</span></code> columns because these cols represent a unique identifier for each row in both data sets. <em>Note</em> that the result has only the intersecton of both datasets. If our demographic data has a DBN that’s not in the test data set,
that school’s data will be dropped from the results.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">demo</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">ela</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;dbn&quot;</span><span class="p">,</span> <span class="s2">&quot;ay&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>dbn</th>
      <th>beds</th>
      <th>district</th>
      <th>geo_district</th>
      <th>boro</th>
      <th>school_name_x</th>
      <th>short_name</th>
      <th>ay</th>
      <th>year</th>
      <th>total_enrollment</th>
      <th>...</th>
      <th>level_2_pct</th>
      <th>level_3_n</th>
      <th>level_3_pct</th>
      <th>level_4_n</th>
      <th>level_4_pct</th>
      <th>level_3_4_n</th>
      <th>level_3_4_pct</th>
      <th>test_year</th>
      <th>charter</th>
      <th>school_name_y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>01M015</td>
      <td>310100010015</td>
      <td>1</td>
      <td>1</td>
      <td>Manhattan</td>
      <td>P.S. 015 Roberto Clemente</td>
      <td>PS 15</td>
      <td>2016</td>
      <td>2016-17</td>
      <td>178</td>
      <td>...</td>
      <td>0.296296</td>
      <td>7.0</td>
      <td>0.259259</td>
      <td>2.0</td>
      <td>0.074074</td>
      <td>9.0</td>
      <td>0.333333</td>
      <td>2017</td>
      <td>0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>01M015</td>
      <td>310100010015</td>
      <td>1</td>
      <td>1</td>
      <td>Manhattan</td>
      <td>P.S. 015 Roberto Clemente</td>
      <td>PS 15</td>
      <td>2016</td>
      <td>2016-17</td>
      <td>178</td>
      <td>...</td>
      <td>0.521739</td>
      <td>9.0</td>
      <td>0.391304</td>
      <td>1.0</td>
      <td>0.043478</td>
      <td>10.0</td>
      <td>0.434783</td>
      <td>2017</td>
      <td>0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>01M015</td>
      <td>310100010015</td>
      <td>1</td>
      <td>1</td>
      <td>Manhattan</td>
      <td>P.S. 015 Roberto Clemente</td>
      <td>PS 15</td>
      <td>2016</td>
      <td>2016-17</td>
      <td>178</td>
      <td>...</td>
      <td>0.647059</td>
      <td>5.0</td>
      <td>0.294118</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>5.0</td>
      <td>0.294118</td>
      <td>2017</td>
      <td>0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>01M015</td>
      <td>310100010015</td>
      <td>1</td>
      <td>1</td>
      <td>Manhattan</td>
      <td>P.S. 015 Roberto Clemente</td>
      <td>PS 15</td>
      <td>2016</td>
      <td>2016-17</td>
      <td>178</td>
      <td>...</td>
      <td>0.462687</td>
      <td>21.0</td>
      <td>0.313433</td>
      <td>3.0</td>
      <td>0.044776</td>
      <td>24.0</td>
      <td>0.358209</td>
      <td>2017</td>
      <td>0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>01M015</td>
      <td>310100010015</td>
      <td>1</td>
      <td>1</td>
      <td>Manhattan</td>
      <td>P.S. 015 Roberto Clemente</td>
      <td>PS 15</td>
      <td>2016</td>
      <td>2016-17</td>
      <td>178</td>
      <td>...</td>
      <td>0.333333</td>
      <td>7.0</td>
      <td>0.333333</td>
      <td>2.0</td>
      <td>0.095238</td>
      <td>9.0</td>
      <td>0.428571</td>
      <td>2017</td>
      <td>0</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 68 columns</p>
</div></div>
</div>
<p>Astute readers will see a new column called <code class="docutils literal notranslate"><span class="pre">school_name_x</span></code> in our results. You can’t see it in the truncated data above, but there is also a <code class="docutils literal notranslate"><span class="pre">school_name_y</span></code>. Both data sets had a <code class="docutils literal notranslate"><span class="pre">school_name</span></code> column, so <code class="docutils literal notranslate"><span class="pre">pandas</span></code> suffixed the one from <code class="docutils literal notranslate"><span class="pre">demo</span></code> with <code class="docutils literal notranslate"><span class="pre">x</span></code> and the one from <code class="docutils literal notranslate"><span class="pre">ela</span></code> with <code class="docutils literal notranslate"><span class="pre">y</span></code>.</p>
<p>Because both columns <em>should</em> contain the same data (because they have the save DBN for the same school year), in this case we can just drop one of the columns before the merge. We’ll drop <code class="docutils literal notranslate"><span class="pre">school_name</span></code> from <code class="docutils literal notranslate"><span class="pre">ela</span></code> because the demographics data set should have our canoninical school names.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ela2</span> <span class="o">=</span> <span class="n">ela</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s2">&quot;school_name&quot;</span><span class="p">)</span>
<span class="n">demo</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">ela2</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;dbn&quot;</span><span class="p">,</span> <span class="s2">&quot;ay&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>dbn</th>
      <th>beds</th>
      <th>district</th>
      <th>geo_district</th>
      <th>boro</th>
      <th>school_name</th>
      <th>short_name</th>
      <th>ay</th>
      <th>year</th>
      <th>total_enrollment</th>
      <th>...</th>
      <th>level_2_n</th>
      <th>level_2_pct</th>
      <th>level_3_n</th>
      <th>level_3_pct</th>
      <th>level_4_n</th>
      <th>level_4_pct</th>
      <th>level_3_4_n</th>
      <th>level_3_4_pct</th>
      <th>test_year</th>
      <th>charter</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>01M015</td>
      <td>310100010015</td>
      <td>1</td>
      <td>1</td>
      <td>Manhattan</td>
      <td>P.S. 015 Roberto Clemente</td>
      <td>PS 15</td>
      <td>2016</td>
      <td>2016-17</td>
      <td>178</td>
      <td>...</td>
      <td>8.0</td>
      <td>0.296296</td>
      <td>7.0</td>
      <td>0.259259</td>
      <td>2.0</td>
      <td>0.074074</td>
      <td>9.0</td>
      <td>0.333333</td>
      <td>2017</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>01M015</td>
      <td>310100010015</td>
      <td>1</td>
      <td>1</td>
      <td>Manhattan</td>
      <td>P.S. 015 Roberto Clemente</td>
      <td>PS 15</td>
      <td>2016</td>
      <td>2016-17</td>
      <td>178</td>
      <td>...</td>
      <td>12.0</td>
      <td>0.521739</td>
      <td>9.0</td>
      <td>0.391304</td>
      <td>1.0</td>
      <td>0.043478</td>
      <td>10.0</td>
      <td>0.434783</td>
      <td>2017</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>01M015</td>
      <td>310100010015</td>
      <td>1</td>
      <td>1</td>
      <td>Manhattan</td>
      <td>P.S. 015 Roberto Clemente</td>
      <td>PS 15</td>
      <td>2016</td>
      <td>2016-17</td>
      <td>178</td>
      <td>...</td>
      <td>11.0</td>
      <td>0.647059</td>
      <td>5.0</td>
      <td>0.294118</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>5.0</td>
      <td>0.294118</td>
      <td>2017</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>01M015</td>
      <td>310100010015</td>
      <td>1</td>
      <td>1</td>
      <td>Manhattan</td>
      <td>P.S. 015 Roberto Clemente</td>
      <td>PS 15</td>
      <td>2016</td>
      <td>2016-17</td>
      <td>178</td>
      <td>...</td>
      <td>31.0</td>
      <td>0.462687</td>
      <td>21.0</td>
      <td>0.313433</td>
      <td>3.0</td>
      <td>0.044776</td>
      <td>24.0</td>
      <td>0.358209</td>
      <td>2017</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>01M015</td>
      <td>310100010015</td>
      <td>1</td>
      <td>1</td>
      <td>Manhattan</td>
      <td>P.S. 015 Roberto Clemente</td>
      <td>PS 15</td>
      <td>2016</td>
      <td>2016-17</td>
      <td>178</td>
      <td>...</td>
      <td>7.0</td>
      <td>0.333333</td>
      <td>7.0</td>
      <td>0.333333</td>
      <td>2.0</td>
      <td>0.095238</td>
      <td>9.0</td>
      <td>0.428571</td>
      <td>2017</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 67 columns</p>
</div></div>
</div>
</section>
<section id="Merge-with-suffixes:-wide-data">
<h2><span class="section-number">2.2. </span>Merge with suffixes: wide data<a class="headerlink" href="#Merge-with-suffixes:-wide-data" title="Permalink to this heading"></a></h2>
<p>When we have a data set where we use columns to represent different categories of data, we can call this “wide data.” In this example, we’re going to make a test results data frame that has math and ela test scores in the same row.</p>
<p>At the start of this notebook we loaded both the math and ela exam data. Note that they have exactly the same columns. When we <em>merge</em> them, we’re going to <strong>suffix</strong> the ela data with <code class="docutils literal notranslate"><span class="pre">_ela</span></code> and the math data with <code class="docutils literal notranslate"><span class="pre">_math</span></code>. We will drop <code class="docutils literal notranslate"><span class="pre">school_name</span></code> from one of the data sets and use <code class="docutils literal notranslate"><span class="pre">[&quot;dbn&quot;,</span> <span class="pre">&quot;ay&quot;,</span> <span class="pre">&quot;test_year&quot;,</span> <span class="pre">&quot;grade&quot;,</span> <span class="pre">&quot;category&quot;]</span></code> to join the two.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ela2</span> <span class="o">=</span> <span class="n">ela</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s2">&quot;school_name&quot;</span><span class="p">)</span>
<span class="n">wide</span> <span class="o">=</span> <span class="n">ela2</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">math</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;dbn&quot;</span><span class="p">,</span> <span class="s2">&quot;ay&quot;</span><span class="p">,</span> <span class="s2">&quot;test_year&quot;</span><span class="p">,</span> <span class="s2">&quot;grade&quot;</span><span class="p">,</span> <span class="s2">&quot;category&quot;</span><span class="p">],</span> <span class="n">suffixes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;_ela&quot;</span><span class="p">,</span> <span class="s2">&quot;_math&quot;</span><span class="p">])</span>
<span class="n">wide</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>dbn</th>
      <th>grade</th>
      <th>category</th>
      <th>number_tested_ela</th>
      <th>mean_scale_score_ela</th>
      <th>level_1_n_ela</th>
      <th>level_1_pct_ela</th>
      <th>level_2_n_ela</th>
      <th>level_2_pct_ela</th>
      <th>level_3_n_ela</th>
      <th>...</th>
      <th>level_2_n_math</th>
      <th>level_2_pct_math</th>
      <th>level_3_n_math</th>
      <th>level_3_pct_math</th>
      <th>level_4_n_math</th>
      <th>level_4_pct_math</th>
      <th>level_3_4_n_math</th>
      <th>level_3_4_pct_math</th>
      <th>charter_math</th>
      <th>school_name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>01M015</td>
      <td>3</td>
      <td>All Students</td>
      <td>27</td>
      <td>289.296295</td>
      <td>14.0</td>
      <td>0.518519</td>
      <td>11.0</td>
      <td>0.407407</td>
      <td>2.0</td>
      <td>...</td>
      <td>11.0</td>
      <td>0.407407</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>01M015</td>
      <td>4</td>
      <td>All Students</td>
      <td>20</td>
      <td>277.649994</td>
      <td>8.0</td>
      <td>0.400000</td>
      <td>11.0</td>
      <td>0.550000</td>
      <td>1.0</td>
      <td>...</td>
      <td>6.0</td>
      <td>0.300000</td>
      <td>1.0</td>
      <td>0.050000</td>
      <td>1.0</td>
      <td>0.050000</td>
      <td>2.0</td>
      <td>0.100000</td>
      <td>0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>01M015</td>
      <td>5</td>
      <td>All Students</td>
      <td>24</td>
      <td>283.958344</td>
      <td>12.0</td>
      <td>0.500000</td>
      <td>11.0</td>
      <td>0.458333</td>
      <td>1.0</td>
      <td>...</td>
      <td>6.0</td>
      <td>0.250000</td>
      <td>1.0</td>
      <td>0.041667</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>1.0</td>
      <td>0.041667</td>
      <td>0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>01M015</td>
      <td>All Grades</td>
      <td>All Students</td>
      <td>71</td>
      <td>284.211273</td>
      <td>34.0</td>
      <td>0.478873</td>
      <td>33.0</td>
      <td>0.464789</td>
      <td>4.0</td>
      <td>...</td>
      <td>23.0</td>
      <td>0.323944</td>
      <td>2.0</td>
      <td>0.028169</td>
      <td>1.0</td>
      <td>0.014085</td>
      <td>3.0</td>
      <td>0.042254</td>
      <td>0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>01M015</td>
      <td>3</td>
      <td>Not SWD</td>
      <td>19</td>
      <td>287.157898</td>
      <td>11.0</td>
      <td>0.578947</td>
      <td>8.0</td>
      <td>0.421053</td>
      <td>0.0</td>
      <td>...</td>
      <td>8.0</td>
      <td>0.421053</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 32 columns</p>
</div></div>
</div>
<p>Now that we have the wide data, we can easily compare math and ela results for the same set school/year/grade/category. Below we will calculate a new column called <code class="docutils literal notranslate"><span class="pre">test_delta</span></code> that shows the difference between math and ela results for the same cohort of students in the same school. This will let us see, for example, which if any schools are “unbalanced” in math and ELA. Later, we might correlate this to other demographic data such as high percentages of ELL or SWD students.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wide</span><span class="p">[</span><span class="s2">&quot;test_delta&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wide</span><span class="o">.</span><span class="n">mean_scale_score_math</span> <span class="o">-</span> <span class="n">wide</span><span class="o">.</span><span class="n">mean_scale_score_ela</span>
<span class="n">wide</span><span class="p">[</span><span class="s2">&quot;test_delta_abs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">wide</span><span class="o">.</span><span class="n">mean_scale_score_math</span> <span class="o">-</span> <span class="n">wide</span><span class="o">.</span><span class="n">mean_scale_score_ela</span><span class="p">)</span>

<span class="n">wide</span> <span class="o">=</span> <span class="n">wide</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;test_delta_abs&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">wide</span><span class="p">[[</span><span class="s2">&quot;dbn&quot;</span><span class="p">,</span><span class="s2">&quot;grade&quot;</span><span class="p">,</span><span class="s2">&quot;ay&quot;</span><span class="p">,</span><span class="s2">&quot;category&quot;</span><span class="p">,</span><span class="s2">&quot;mean_scale_score_math&quot;</span><span class="p">,</span> <span class="s2">&quot;mean_scale_score_ela&quot;</span><span class="p">,</span> <span class="s2">&quot;test_delta&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>dbn</th>
      <th>grade</th>
      <th>ay</th>
      <th>category</th>
      <th>mean_scale_score_math</th>
      <th>mean_scale_score_ela</th>
      <th>test_delta</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>28254</th>
      <td>03M054</td>
      <td>8</td>
      <td>2014</td>
      <td>Never ELL</td>
      <td>243.764710</td>
      <td>331.356811</td>
      <td>-87.592102</td>
    </tr>
    <tr>
      <th>82041</th>
      <td>07X500</td>
      <td>8</td>
      <td>2014</td>
      <td>Female</td>
      <td>210.500000</td>
      <td>296.057129</td>
      <td>-85.557129</td>
    </tr>
    <tr>
      <th>28230</th>
      <td>03M054</td>
      <td>8</td>
      <td>2014</td>
      <td>Female</td>
      <td>244.666672</td>
      <td>329.838715</td>
      <td>-85.172043</td>
    </tr>
    <tr>
      <th>82020</th>
      <td>07X500</td>
      <td>8</td>
      <td>2014</td>
      <td>Not SWD</td>
      <td>222.750000</td>
      <td>301.250000</td>
      <td>-78.500000</td>
    </tr>
    <tr>
      <th>240736</th>
      <td>20K105</td>
      <td>5</td>
      <td>2015</td>
      <td>Current ELL</td>
      <td>330.679260</td>
      <td>252.888885</td>
      <td>77.790375</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="Concatenate-DataFrames:-long-data">
<h2><span class="section-number">2.3. </span>Concatenate DataFrames: long data<a class="headerlink" href="#Concatenate-DataFrames:-long-data" title="Permalink to this heading"></a></h2>
<p>If we have two DataFrames with the same columns (like our math and ela results) we can concatenate the data from one df onto the other to create a longer dataframe. Generally, this is a more flexible format for analysis than the wide data format. In our math/ela example, it allows us to, for example, easily average the math and ela test scores together (filtering for group, year, etc).</p>
<p>In the example here we will add a new column, <code class="docutils literal notranslate"><span class="pre">test</span></code>, which will have the value of “ela” or “math”. This column will let us know whether that row reports a math test or ela test result.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">math</span><span class="p">[</span><span class="s2">&quot;test&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;math&quot;</span>
<span class="n">ela</span><span class="p">[</span><span class="s2">&quot;test&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ela&quot;</span>
<span class="n">long</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">math</span><span class="p">,</span> <span class="n">ela</span><span class="p">])</span>
<span class="n">long</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>dbn</th>
      <th>grade</th>
      <th>category</th>
      <th>number_tested</th>
      <th>mean_scale_score</th>
      <th>level_1_n</th>
      <th>level_1_pct</th>
      <th>level_2_n</th>
      <th>level_2_pct</th>
      <th>level_3_n</th>
      <th>level_3_pct</th>
      <th>level_4_n</th>
      <th>level_4_pct</th>
      <th>level_3_4_n</th>
      <th>level_3_4_pct</th>
      <th>test_year</th>
      <th>ay</th>
      <th>charter</th>
      <th>school_name</th>
      <th>test</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>01M015</td>
      <td>3</td>
      <td>All Students</td>
      <td>27</td>
      <td>277.777771</td>
      <td>16.0</td>
      <td>0.592593</td>
      <td>11.0</td>
      <td>0.407407</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>2013</td>
      <td>2012</td>
      <td>0</td>
      <td>NaN</td>
      <td>math</td>
    </tr>
    <tr>
      <th>7</th>
      <td>01M015</td>
      <td>4</td>
      <td>All Students</td>
      <td>20</td>
      <td>277.399994</td>
      <td>12.0</td>
      <td>0.600000</td>
      <td>6.0</td>
      <td>0.300000</td>
      <td>1.0</td>
      <td>0.050000</td>
      <td>1.0</td>
      <td>0.050000</td>
      <td>2.0</td>
      <td>0.100000</td>
      <td>2013</td>
      <td>2012</td>
      <td>0</td>
      <td>NaN</td>
      <td>math</td>
    </tr>
    <tr>
      <th>14</th>
      <td>01M015</td>
      <td>5</td>
      <td>All Students</td>
      <td>24</td>
      <td>274.000000</td>
      <td>17.0</td>
      <td>0.708333</td>
      <td>6.0</td>
      <td>0.250000</td>
      <td>1.0</td>
      <td>0.041667</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>1.0</td>
      <td>0.041667</td>
      <td>2013</td>
      <td>2012</td>
      <td>0</td>
      <td>NaN</td>
      <td>math</td>
    </tr>
    <tr>
      <th>21</th>
      <td>01M015</td>
      <td>All Grades</td>
      <td>All Students</td>
      <td>71</td>
      <td>276.394379</td>
      <td>45.0</td>
      <td>0.633803</td>
      <td>23.0</td>
      <td>0.323944</td>
      <td>2.0</td>
      <td>0.028169</td>
      <td>1.0</td>
      <td>0.014085</td>
      <td>3.0</td>
      <td>0.042254</td>
      <td>2013</td>
      <td>2012</td>
      <td>0</td>
      <td>NaN</td>
      <td>math</td>
    </tr>
    <tr>
      <th>32606</th>
      <td>01M015</td>
      <td>3</td>
      <td>Not SWD</td>
      <td>19</td>
      <td>275.736847</td>
      <td>11.0</td>
      <td>0.578947</td>
      <td>8.0</td>
      <td>0.421053</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>2013</td>
      <td>2012</td>
      <td>0</td>
      <td>NaN</td>
      <td>math</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>430002</th>
      <td>84X730</td>
      <td>3</td>
      <td>All Students</td>
      <td>51</td>
      <td>602.000000</td>
      <td>2.0</td>
      <td>0.039000</td>
      <td>22.0</td>
      <td>0.431000</td>
      <td>23.0</td>
      <td>0.451000</td>
      <td>4.0</td>
      <td>0.078000</td>
      <td>27.0</td>
      <td>0.529000</td>
      <td>2019</td>
      <td>2018</td>
      <td>1</td>
      <td>BRONX CHARTER SCHOOL FOR THE ARTS</td>
      <td>ela</td>
    </tr>
    <tr>
      <th>430009</th>
      <td>84X730</td>
      <td>4</td>
      <td>All Students</td>
      <td>49</td>
      <td>591.000000</td>
      <td>18.0</td>
      <td>0.367000</td>
      <td>14.0</td>
      <td>0.286000</td>
      <td>13.0</td>
      <td>0.265000</td>
      <td>4.0</td>
      <td>0.082000</td>
      <td>17.0</td>
      <td>0.347000</td>
      <td>2019</td>
      <td>2018</td>
      <td>1</td>
      <td>BRONX CHARTER SCHOOL FOR THE ARTS</td>
      <td>ela</td>
    </tr>
    <tr>
      <th>430016</th>
      <td>84X730</td>
      <td>5</td>
      <td>All Students</td>
      <td>53</td>
      <td>597.000000</td>
      <td>18.0</td>
      <td>0.340000</td>
      <td>20.0</td>
      <td>0.377000</td>
      <td>8.0</td>
      <td>0.151000</td>
      <td>7.0</td>
      <td>0.132000</td>
      <td>15.0</td>
      <td>0.283000</td>
      <td>2019</td>
      <td>2018</td>
      <td>1</td>
      <td>BRONX CHARTER SCHOOL FOR THE ARTS</td>
      <td>ela</td>
    </tr>
    <tr>
      <th>430017</th>
      <td>84X730</td>
      <td>6</td>
      <td>All Students</td>
      <td>113</td>
      <td>592.000000</td>
      <td>45.0</td>
      <td>0.398000</td>
      <td>33.0</td>
      <td>0.292000</td>
      <td>23.0</td>
      <td>0.204000</td>
      <td>12.0</td>
      <td>0.106000</td>
      <td>35.0</td>
      <td>0.310000</td>
      <td>2019</td>
      <td>2018</td>
      <td>1</td>
      <td>BRONX CHARTER SCHOOL FOR THE ARTS</td>
      <td>ela</td>
    </tr>
    <tr>
      <th>430024</th>
      <td>84X730</td>
      <td>All Grades</td>
      <td>All Students</td>
      <td>266</td>
      <td>594.000000</td>
      <td>83.0</td>
      <td>0.312000</td>
      <td>89.0</td>
      <td>0.335000</td>
      <td>67.0</td>
      <td>0.252000</td>
      <td>27.0</td>
      <td>0.102000</td>
      <td>94.0</td>
      <td>0.353000</td>
      <td>2019</td>
      <td>2018</td>
      <td>1</td>
      <td>BRONX CHARTER SCHOOL FOR THE ARTS</td>
      <td>ela</td>
    </tr>
  </tbody>
</table>
<p>856567 rows × 20 columns</p>
</div></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="01-group-and-agg.html" class="btn btn-neutral float-left" title="1. Groups &amp; Aggregates" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../03-Graphs-and-Charts/index.html" class="btn btn-neutral float-right" title="Graphs &amp; Charts" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Matthew X. Curinga.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>