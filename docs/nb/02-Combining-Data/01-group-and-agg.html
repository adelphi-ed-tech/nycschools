<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>1. Groups &amp; Aggregates &mdash; NYC Schools Open Data 0.1.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script src="../../_static/custom.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="2. Merges &amp; Joins" href="02-merge-and-join.html" />
    <link rel="prev" title="Combining Data" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> NYC Schools Open Data
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../01-Basics/index.html">1. Data Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html">Combining Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03-Graphs-and-Charts/index.html">Graphs &amp; Charts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../04-Statistics/index.html">Statistics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../05-Maps-and-GIS/index.html">2. Maps &amp; GIS</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../data-sources.html">Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/nycschools.html">API Docs</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">NYC Schools Open Data</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Combining Data</a></li>
      <li class="breadcrumb-item active"><span class="section-number">1. </span>Groups &amp; Aggregates</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/nb/02-Combining-Data/01-group-and-agg.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars and line breaks on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
    white-space: pre;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="Groups-&amp;-Aggregates">
<h1><span class="section-number">1. </span>Groups &amp; Aggregates<a class="headerlink" href="#Groups-&-Aggregates" title="Permalink to this heading"></a></h1>
<p>In this notebook we look at how to change the level that we use to analyze data by <strong>grouping</strong> multiple rows into a single row. This <code class="docutils literal notranslate"><span class="pre">groupby</span></code> function allows us to look at the school data by district, borough, or academic year. To group data, you specifiy the column name or column names for the group. All unique names or combinations will become a single row.</p>
<p>The <em>other</em> rows of data need to be <strong>aggregated</strong> in some way. Common aggregate functions include <code class="docutils literal notranslate"><span class="pre">sum</span></code> (e.g. find the total enrolled students in Brooklyn), <code class="docutils literal notranslate"><span class="pre">count</span></code> (find unique schools in Queens), and <code class="docutils literal notranslate"><span class="pre">mean</span></code> (find the average percent poverty of students in the Bronx).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nycschools</span> <span class="kn">import</span> <span class="n">schools</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">schools</span><span class="o">.</span><span class="n">load_school_demographics</span><span class="p">()</span>
</pre></div>
</div>
</div>
<section id="Total-Enrollment-by-Boro">
<h2><span class="section-number">1.1. </span>Total Enrollment by Boro<a class="headerlink" href="#Total-Enrollment-by-Boro" title="Permalink to this heading"></a></h2>
<p>For this example, we create a simplified data set that only has 2 columns: <code class="docutils literal notranslate"><span class="pre">boro</span></code> and <code class="docutils literal notranslate"><span class="pre">total_enrollment</span></code>. We also limit it to only the 2020 academic year.</p>
<p>We call the <code class="docutils literal notranslate"><span class="pre">groupby()</span></code> function of <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>and pass in “boro” as the column name for the group. From there, we call <code class="docutils literal notranslate"><span class="pre">.sum()</span></code> on the resulting GroupBy object. This will sum up the enrollment in each school, in each borough.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">boros</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">ay</span> <span class="o">==</span> <span class="mi">2020</span><span class="p">]</span>
<span class="n">boros</span> <span class="o">=</span> <span class="n">boros</span><span class="p">[[</span><span class="s2">&quot;boro&quot;</span><span class="p">,</span> <span class="s2">&quot;total_enrollment&quot;</span><span class="p">]]</span>

<span class="n">boros</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;boro&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>total_enrollment</th>
    </tr>
    <tr>
      <th>boro</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Bronx</th>
      <td>238074</td>
    </tr>
    <tr>
      <th>Brooklyn</th>
      <td>346802</td>
    </tr>
    <tr>
      <th>Manhattan</th>
      <td>194144</td>
    </tr>
    <tr>
      <th>Queens</th>
      <td>305660</td>
    </tr>
    <tr>
      <th>Staten Island</th>
      <td>63824</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>We see in th results that Brooklyn had the most students enrolled in 2020 (n=346802) and Staten Island had the fewest (n=63824).</p>
<p>We also notice that <code class="docutils literal notranslate"><span class="pre">total_enrolmment</span></code> doesn’t appear on the same level as <code class="docutils literal notranslate"><span class="pre">boro</span></code>. If we want to be able to treat <code class="docutils literal notranslate"><span class="pre">total_enrollment</span></code> as a “normal” column, we need to call <code class="docutils literal notranslate"><span class="pre">reset_index()</span></code> after our aggregate function.</p>
<p>Like this:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">boros</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;boro&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>boro</th>
      <th>total_enrollment</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Bronx</td>
      <td>238074</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Brooklyn</td>
      <td>346802</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Manhattan</td>
      <td>194144</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Queens</td>
      <td>305660</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Staten Island</td>
      <td>63824</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="Using-a-dict-of-aggregate-columns">
<h2><span class="section-number">1.2. </span>Using a <code class="docutils literal notranslate"><span class="pre">dict</span></code> of aggregate columns<a class="headerlink" href="#Using-a-dict-of-aggregate-columns" title="Permalink to this heading"></a></h2>
<p>Now, we might have a few more questions about this simple measure of school enrollment. For example, what was the average enrollment, and how many different schools are in each borough?</p>
<p>We can answer these questions by running by adding more columns (namely <code class="docutils literal notranslate"><span class="pre">dbn</span></code>) to our data and using different aggregate functions. In this case we will use <code class="docutils literal notranslate"><span class="pre">sum</span></code>, <code class="docutils literal notranslate"><span class="pre">count</span></code>, <code class="docutils literal notranslate"><span class="pre">mean</span></code>, <code class="docutils literal notranslate"><span class="pre">min</span></code>, and <code class="docutils literal notranslate"><span class="pre">max</span></code>.</p>
<p>To accomplish this, we call the <code class="docutils literal notranslate"><span class="pre">agg</span></code> function on the results of the groupby and pass in a dictionary where the column names are keys, and the aggregate function(s) are the values. If we want only a single agg function, we can use that as the value, but if we want multiple functions, we can set a list of strings as the value.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">boros</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">ay</span> <span class="o">==</span> <span class="mi">2020</span><span class="p">]</span>
<span class="n">boros</span> <span class="o">=</span> <span class="n">boros</span><span class="p">[[</span><span class="s2">&quot;boro&quot;</span><span class="p">,</span> <span class="s2">&quot;dbn&quot;</span><span class="p">,</span> <span class="s2">&quot;total_enrollment&quot;</span><span class="p">]]</span>
<span class="n">boros</span> <span class="o">=</span> <span class="n">boros</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;boro&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span>
    <span class="s2">&quot;dbn&quot;</span><span class="p">:</span><span class="s2">&quot;count&quot;</span><span class="p">,</span>
    <span class="s2">&quot;total_enrollment&quot;</span><span class="p">:[</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;min&quot;</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">]})</span>
<span class="n">boros</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th>dbn</th>
      <th colspan="4" halign="left">total_enrollment</th>
    </tr>
    <tr>
      <th></th>
      <th>count</th>
      <th>sum</th>
      <th>mean</th>
      <th>min</th>
      <th>max</th>
    </tr>
    <tr>
      <th>boro</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Bronx</th>
      <td>496</td>
      <td>238074</td>
      <td>479.987903</td>
      <td>7</td>
      <td>2936</td>
    </tr>
    <tr>
      <th>Brooklyn</th>
      <td>640</td>
      <td>346802</td>
      <td>541.878125</td>
      <td>46</td>
      <td>5921</td>
    </tr>
    <tr>
      <th>Manhattan</th>
      <td>408</td>
      <td>194144</td>
      <td>475.843137</td>
      <td>14</td>
      <td>3342</td>
    </tr>
    <tr>
      <th>Queens</th>
      <td>421</td>
      <td>305660</td>
      <td>726.033254</td>
      <td>42</td>
      <td>4424</td>
    </tr>
    <tr>
      <th>Staten Island</th>
      <td>83</td>
      <td>63824</td>
      <td>768.963855</td>
      <td>144</td>
      <td>3726</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="Resetting-the-index">
<h2><span class="section-number">1.3. </span>Resetting the index<a class="headerlink" href="#Resetting-the-index" title="Permalink to this heading"></a></h2>
<p>In the results above, we say that the aggregate columns do not appear in the same row as the grouped column, boro. Also, there are 2 levels to the aggregate index because we have 4 columns for total_enrollment. Sometimes we want to convert these columnbs back into a flat index. This makes it easier to filter, merge, and sort the data and to access specific Series in the DataFrame. Unfortunately, we can’t simply call <code class="docutils literal notranslate"><span class="pre">reset_index()</span></code> like we did above.</p>
<p>Here after we reset the index, we rename all of the columns with a new list of strings. The length of the new list musth match the number of columns.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">boros</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">ay</span> <span class="o">==</span> <span class="mi">2020</span><span class="p">]</span>
<span class="n">boros</span> <span class="o">=</span> <span class="n">boros</span><span class="p">[[</span><span class="s2">&quot;boro&quot;</span><span class="p">,</span> <span class="s2">&quot;dbn&quot;</span><span class="p">,</span> <span class="s2">&quot;total_enrollment&quot;</span><span class="p">]]</span>
<span class="n">table</span> <span class="o">=</span> <span class="n">boros</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;boro&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span>
    <span class="s2">&quot;dbn&quot;</span><span class="p">:</span><span class="s2">&quot;count&quot;</span><span class="p">,</span>
    <span class="s2">&quot;total_enrollment&quot;</span><span class="p">:[</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;min&quot;</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">]})</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Borough&quot;</span><span class="p">,</span> <span class="s2">&quot;Num. Schools&quot;</span><span class="p">,</span> <span class="s2">&quot;Total Students&quot;</span><span class="p">,</span> <span class="s2">&quot;Avg School Size&quot;</span><span class="p">,</span> <span class="s2">&quot;Smallest School&quot;</span><span class="p">,</span> <span class="s2">&quot;Largest School&quot;</span><span class="p">]</span>
<span class="n">table</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">cols</span>
<span class="n">table</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Borough</th>
      <th>Num. Schools</th>
      <th>Total Students</th>
      <th>Avg School Size</th>
      <th>Smallest School</th>
      <th>Largest School</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Bronx</td>
      <td>496</td>
      <td>238074</td>
      <td>479.987903</td>
      <td>7</td>
      <td>2936</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Brooklyn</td>
      <td>640</td>
      <td>346802</td>
      <td>541.878125</td>
      <td>46</td>
      <td>5921</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Manhattan</td>
      <td>408</td>
      <td>194144</td>
      <td>475.843137</td>
      <td>14</td>
      <td>3342</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Queens</td>
      <td>421</td>
      <td>305660</td>
      <td>726.033254</td>
      <td>42</td>
      <td>4424</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Staten Island</td>
      <td>83</td>
      <td>63824</td>
      <td>768.963855</td>
      <td>144</td>
      <td>3726</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="Grouping-by-Multiple-Columns">
<h2><span class="section-number">1.4. </span>Grouping by Multiple Columns<a class="headerlink" href="#Grouping-by-Multiple-Columns" title="Permalink to this heading"></a></h2>
<p>Sometimes we might want to pass in more than one column as the group by index. In this example we will group our data by borough and whether they are a charter school or not.</p>
<p>Note a couple of things in this short example:</p>
<ol class="arabic simple">
<li><p>We call <code class="docutils literal notranslate"><span class="pre">copy()</span></code> on <code class="docutils literal notranslate"><span class="pre">df</span></code> because we are adding a new column and don’t want to mess with the original data frame</p></li>
<li><p>We use a lambda function in apply, and we use a special type of if/else statement usually called a “ternary” operation</p></li>
<li><p>Because we’re doing several agg functions, we will create them as a dict <em>before</em> we call <code class="docutils literal notranslate"><span class="pre">agg()</span></code>. This is just to make our code easier to read and maintain</p></li>
</ol>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># because we&#39;re adding data to our subset, we&#39;re going to call copy()</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">ay</span> <span class="o">==</span> <span class="mi">2020</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">data</span><span class="p">[</span><span class="s2">&quot;school type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">district</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;charter&quot;</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">84</span> <span class="k">else</span> <span class="s2">&quot;public&quot;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s2">&quot;boro&quot;</span><span class="p">,</span><span class="s2">&quot;school type&quot;</span><span class="p">,</span><span class="s2">&quot;dbn&quot;</span><span class="p">,</span><span class="s2">&quot;asian_pct&quot;</span><span class="p">,</span><span class="s2">&quot;black_pct&quot;</span><span class="p">,</span><span class="s2">&quot;hispanic_pct&quot;</span><span class="p">,</span><span class="s2">&quot;white_pct&quot;</span><span class="p">]]</span>
<span class="n">aggs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;dbn&quot;</span><span class="p">:</span> <span class="s2">&quot;count&quot;</span><span class="p">,</span>
    <span class="s2">&quot;asian_pct&quot;</span><span class="p">:</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span>
    <span class="s2">&quot;black_pct&quot;</span><span class="p">:</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span>
    <span class="s2">&quot;hispanic_pct&quot;</span><span class="p">:</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span>
    <span class="s2">&quot;white_pct&quot;</span><span class="p">:</span> <span class="s2">&quot;mean&quot;</span>
<span class="p">}</span>


<span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;boro&quot;</span><span class="p">,</span> <span class="s2">&quot;school type&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">aggs</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>boro</th>
      <th>school type</th>
      <th>dbn</th>
      <th>asian_pct</th>
      <th>black_pct</th>
      <th>hispanic_pct</th>
      <th>white_pct</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Bronx</td>
      <td>charter</td>
      <td>89</td>
      <td>0.022963</td>
      <td>0.377873</td>
      <td>0.569022</td>
      <td>0.011857</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Bronx</td>
      <td>public</td>
      <td>407</td>
      <td>0.041388</td>
      <td>0.257767</td>
      <td>0.645111</td>
      <td>0.039413</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Brooklyn</td>
      <td>charter</td>
      <td>102</td>
      <td>0.029157</td>
      <td>0.600608</td>
      <td>0.268745</td>
      <td>0.071765</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Brooklyn</td>
      <td>public</td>
      <td>538</td>
      <td>0.121413</td>
      <td>0.408924</td>
      <td>0.306846</td>
      <td>0.137351</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Manhattan</td>
      <td>charter</td>
      <td>57</td>
      <td>0.026281</td>
      <td>0.445404</td>
      <td>0.463035</td>
      <td>0.037228</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Manhattan</td>
      <td>public</td>
      <td>351</td>
      <td>0.106721</td>
      <td>0.208111</td>
      <td>0.467208</td>
      <td>0.176647</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Queens</td>
      <td>charter</td>
      <td>28</td>
      <td>0.092321</td>
      <td>0.402000</td>
      <td>0.406929</td>
      <td>0.066893</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Queens</td>
      <td>public</td>
      <td>393</td>
      <td>0.262712</td>
      <td>0.197873</td>
      <td>0.380275</td>
      <td>0.119517</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Staten Island</td>
      <td>charter</td>
      <td>6</td>
      <td>0.021333</td>
      <td>0.258500</td>
      <td>0.437667</td>
      <td>0.237333</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Staten Island</td>
      <td>public</td>
      <td>77</td>
      <td>0.116519</td>
      <td>0.142909</td>
      <td>0.319675</td>
      <td>0.392117</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Combining Data" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="02-merge-and-join.html" class="btn btn-neutral float-right" title="2. Merges &amp; Joins" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Matthew X. Curinga.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>