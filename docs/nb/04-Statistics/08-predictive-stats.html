<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>3. Predictive Statistics &mdash; NYC Schools Open Data 0.1.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Maps &amp; GIS" href="../05-Maps-and-GIS/index.html" />
    <link rel="prev" title="2. ANOVA and OLS Regression" href="05-anova-ols.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> NYC Schools Open Data
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../01-Basics/index.html">Data Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02-Combining-Data/index.html">Combining Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03-Graphs-and-Charts/index.html">Graphs &amp; Charts</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html">Statistics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../05-Maps-and-GIS/index.html">Maps &amp; GIS</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../data-sources.html">Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/nycschools.html">API Docs</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">NYC Schools Open Data</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Statistics</a></li>
      <li class="breadcrumb-item active"><span class="section-number">3. </span>Predictive Statistics</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/nb/04-Statistics/08-predictive-stats.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars and line breaks on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
    white-space: pre;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="Predictive-Statistics">
<h1><span class="section-number">3. </span>Predictive Statistics<a class="headerlink" href="#Predictive-Statistics" title="Permalink to this heading"></a></h1>
<p>This notebook uses the <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> library to run some machine learning predictions using regression analysis. It has examples of both Ordinary Least Square and Partial Least Square Regression.</p>
<p>We look at school demographics to see how well we can use those factors to predict mean_scale_score. We look at the grades 3-8 NYS math exams for the most recent academic year in our data set.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">r2_score</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">scale</span>
<span class="kn">from</span> <span class="nn">sklearn.cross_decomposition</span> <span class="kn">import</span> <span class="n">PLSRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="kn">import</span> <span class="n">chi2</span>

<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Markdown</span> <span class="k">as</span> <span class="n">md</span>

<span class="kn">from</span> <span class="nn">nycschools</span> <span class="kn">import</span> <span class="n">schools</span><span class="p">,</span> <span class="n">ui</span><span class="p">,</span> <span class="n">exams</span>
<br/></pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load the demographic data and merge it with the math data</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">schools</span><span class="o">.</span><span class="n">load_school_demographics</span><span class="p">()</span>

<span class="n">math_df</span> <span class="o">=</span> <span class="n">exams</span><span class="o">.</span><span class="n">load_math</span><span class="p">()</span>

<span class="n">math_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">math_df</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;dbn&quot;</span><span class="p">,</span> <span class="s2">&quot;ay&quot;</span><span class="p">])</span>
<span class="n">math_df</span> <span class="o">=</span> <span class="n">math_df</span><span class="p">[</span><span class="n">math_df</span><span class="p">[</span><span class="s2">&quot;mean_scale_score&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span>
<span class="n">math_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>dbn</th>
      <th>beds</th>
      <th>district</th>
      <th>geo_district</th>
      <th>boro</th>
      <th>school_name_x</th>
      <th>short_name</th>
      <th>ay</th>
      <th>year</th>
      <th>total_enrollment</th>
      <th>...</th>
      <th>level_2_pct</th>
      <th>level_3_n</th>
      <th>level_3_pct</th>
      <th>level_4_n</th>
      <th>level_4_pct</th>
      <th>level_3_4_n</th>
      <th>level_3_4_pct</th>
      <th>test_year</th>
      <th>charter</th>
      <th>school_name_y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>01M015</td>
      <td>310100010015</td>
      <td>1</td>
      <td>1</td>
      <td>Manhattan</td>
      <td>P.S. 015 Roberto Clemente</td>
      <td>PS 15</td>
      <td>2016</td>
      <td>2016-17</td>
      <td>178</td>
      <td>...</td>
      <td>0.310345</td>
      <td>7.0</td>
      <td>0.241379</td>
      <td>5.0</td>
      <td>0.172414</td>
      <td>12.0</td>
      <td>0.413793</td>
      <td>2017</td>
      <td>0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>01M015</td>
      <td>310100010015</td>
      <td>1</td>
      <td>1</td>
      <td>Manhattan</td>
      <td>P.S. 015 Roberto Clemente</td>
      <td>PS 15</td>
      <td>2016</td>
      <td>2016-17</td>
      <td>178</td>
      <td>...</td>
      <td>0.347826</td>
      <td>8.0</td>
      <td>0.347826</td>
      <td>1.0</td>
      <td>0.043478</td>
      <td>9.0</td>
      <td>0.391304</td>
      <td>2017</td>
      <td>0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>01M015</td>
      <td>310100010015</td>
      <td>1</td>
      <td>1</td>
      <td>Manhattan</td>
      <td>P.S. 015 Roberto Clemente</td>
      <td>PS 15</td>
      <td>2016</td>
      <td>2016-17</td>
      <td>178</td>
      <td>...</td>
      <td>0.294118</td>
      <td>8.0</td>
      <td>0.470588</td>
      <td>2.0</td>
      <td>0.117647</td>
      <td>10.0</td>
      <td>0.588235</td>
      <td>2017</td>
      <td>0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>01M015</td>
      <td>310100010015</td>
      <td>1</td>
      <td>1</td>
      <td>Manhattan</td>
      <td>P.S. 015 Roberto Clemente</td>
      <td>PS 15</td>
      <td>2016</td>
      <td>2016-17</td>
      <td>178</td>
      <td>...</td>
      <td>0.318841</td>
      <td>23.0</td>
      <td>0.333333</td>
      <td>8.0</td>
      <td>0.115942</td>
      <td>31.0</td>
      <td>0.449275</td>
      <td>2017</td>
      <td>0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>01M015</td>
      <td>310100010015</td>
      <td>1</td>
      <td>1</td>
      <td>Manhattan</td>
      <td>P.S. 015 Roberto Clemente</td>
      <td>PS 15</td>
      <td>2016</td>
      <td>2016-17</td>
      <td>178</td>
      <td>...</td>
      <td>0.391304</td>
      <td>6.0</td>
      <td>0.260870</td>
      <td>4.0</td>
      <td>0.173913</td>
      <td>10.0</td>
      <td>0.434783</td>
      <td>2017</td>
      <td>0</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 68 columns</p>
</div></div>
</div>
<section id="Predicting-test-scores">
<h2><span class="section-number">3.1. </span>Predicting test scores<a class="headerlink" href="#Predicting-test-scores" title="Permalink to this heading"></a></h2>
<p>Using OLS regression we will see how well we can predict mean_scale_score for the “All Students” category. We will run this with several variations of factors to see which factors have the strongest prediction.</p>
<p>The basic ideas of a predictive model is that we will use some of our data to “train” the model and use the other portion to “test” the model. Once we calculate a coeefficient for each factor, we can use those values to adjust the data sets mean score for a particular case.</p>
<p>These examples will use two statistical measures to compare our models:</p>
<ul class="simple">
<li><p>r-squared is a number between 0 and 1 that will tell us how closely our predictions match the actual recorded score (1 is perfect, 0 is no matches)</p></li>
<li><p>mean squared error (<code class="docutils literal notranslate"><span class="pre">rmse</span></code>) tells us the mean distance between predictions and recorded scores in the same scale as our exam; so an rmse of 10 means that, on average, our predictions were 10 points away from the actual score</p></li>
</ul>
<section id="Correlation-table">
<h3><span class="section-number">3.1.1. </span>Correlation table<a class="headerlink" href="#Correlation-table" title="Permalink to this heading"></a></h3>
<p>First, let’s see how the factors correlate with each other, and with our dependent variable. This table uses a “coolwarm” color map. Darker red indicates a strong positive correlation and darker blue a strong negative correlation.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get just the 2019 test results for All Students</span>
<span class="c1"># this will be the dependent variable in our regression</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">math_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ay == </span><span class="si">{</span><span class="n">math_df</span><span class="o">.</span><span class="n">ay</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2"> and category == &#39;All Students&#39;&quot;</span><span class="p">)</span>
<span class="c1"># calculate coefficients for these factors</span>
<span class="n">factors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;total_enrollment&#39;</span><span class="p">,</span> <span class="s1">&#39;asian_pct&#39;</span><span class="p">,</span><span class="s1">&#39;black_pct&#39;</span><span class="p">,</span>
       <span class="s1">&#39;hispanic_pct&#39;</span><span class="p">,</span>  <span class="s1">&#39;white_pct&#39;</span><span class="p">,</span><span class="s1">&#39;swd_pct&#39;</span><span class="p">,</span> <span class="s1">&#39;ell_pct&#39;</span><span class="p">,</span>
       <span class="s1">&#39;poverty_pct&#39;</span><span class="p">,</span> <span class="s1">&#39;charter&#39;</span><span class="p">,</span> <span class="s2">&quot;eni_pct&quot;</span><span class="p">,</span> <span class="s2">&quot;geo_district&quot;</span><span class="p">]</span>


<span class="n">dv_stats</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">mean_scale_score</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
<span class="n">display</span><span class="p">(</span><span class="n">md</span><span class="p">(</span><span class="s2">&quot;**Descriptive statistics for mean scale score**&quot;</span><span class="p">))</span>

<span class="n">display</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dv_stats</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<p><strong>Descriptive statistics for mean scale score</strong></p>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean_scale_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>6194.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>600.830675</td>
    </tr>
    <tr>
      <th>std</th>
      <td>11.344600</td>
    </tr>
    <tr>
      <th>min</th>
      <td>565.111084</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>592.223618</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>599.833649</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>608.619659</td>
    </tr>
    <tr>
      <th>max</th>
      <td>639.000000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s2">&quot;mean_scale_score&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">factors</span><span class="p">]</span>
<span class="n">data</span><span class="o">.</span><span class="n">charter</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">charter</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">x</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">corr</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;mean_scale_score&quot;</span><span class="p">)</span>
<span class="n">corr</span> <span class="o">=</span> <span class="n">corr</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">background_gradient</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">coolwarm</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">md</span><span class="p">(</span><span class="s2">&quot;**Correlation table between factors and mean scale score**&quot;</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">corr</span><span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">md</span><span class="p">(</span><span class="s2">&quot;**Scatter plots of correlations showing covariance of factors**&quot;</span><span class="p">))</span>

<span class="n">sns</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">factors</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<p><strong>Correlation table between factors and mean scale score</strong></p>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<style type="text/css">
#T_e89b0_row0_col0, #T_e89b0_row1_col5, #T_e89b0_row2_col1, #T_e89b0_row2_col9, #T_e89b0_row3_col11, #T_e89b0_row5_col2, #T_e89b0_row5_col4, #T_e89b0_row5_col7, #T_e89b0_row10_col3, #T_e89b0_row10_col8, #T_e89b0_row10_col10, #T_e89b0_row11_col6 {
  background-color: #3b4cc0;
  color: #f1f1f1;
}
#T_e89b0_row0_col1, #T_e89b0_row0_col2, #T_e89b0_row8_col7 {
  background-color: #6485ec;
  color: #f1f1f1;
}
#T_e89b0_row0_col3, #T_e89b0_row6_col2, #T_e89b0_row6_col5, #T_e89b0_row8_col8 {
  background-color: #dddcdc;
  color: #000000;
}
#T_e89b0_row0_col4, #T_e89b0_row4_col8 {
  background-color: #f7b79b;
  color: #000000;
}
#T_e89b0_row0_col5, #T_e89b0_row9_col3, #T_e89b0_row9_col9 {
  background-color: #3d50c3;
  color: #f1f1f1;
}
#T_e89b0_row0_col6 {
  background-color: #f1ccb8;
  color: #000000;
}
#T_e89b0_row0_col7, #T_e89b0_row5_col10 {
  background-color: #f1cdba;
  color: #000000;
}
#T_e89b0_row0_col8, #T_e89b0_row1_col10 {
  background-color: #bd1f2d;
  color: #f1f1f1;
}
#T_e89b0_row0_col9, #T_e89b0_row10_col6 {
  background-color: #85a8fc;
  color: #f1f1f1;
}
#T_e89b0_row0_col10, #T_e89b0_row1_col8, #T_e89b0_row2_col6, #T_e89b0_row3_col4, #T_e89b0_row4_col7, #T_e89b0_row5_col3, #T_e89b0_row6_col11, #T_e89b0_row7_col1, #T_e89b0_row8_col9, #T_e89b0_row9_col2, #T_e89b0_row10_col5, #T_e89b0_row11_col0 {
  background-color: #b40426;
  color: #f1f1f1;
}
#T_e89b0_row0_col11 {
  background-color: #5a78e4;
  color: #f1f1f1;
}
#T_e89b0_row1_col0 {
  background-color: #4055c8;
  color: #f1f1f1;
}
#T_e89b0_row1_col1, #T_e89b0_row3_col9 {
  background-color: #6b8df0;
  color: #f1f1f1;
}
#T_e89b0_row1_col2, #T_e89b0_row3_col0 {
  background-color: #6a8bef;
  color: #f1f1f1;
}
#T_e89b0_row1_col3 {
  background-color: #e5d8d1;
  color: #000000;
}
#T_e89b0_row1_col4 {
  background-color: #f5c1a9;
  color: #000000;
}
#T_e89b0_row1_col6, #T_e89b0_row7_col2, #T_e89b0_row8_col0 {
  background-color: #ead4c8;
  color: #000000;
}
#T_e89b0_row1_col7, #T_e89b0_row11_col2 {
  background-color: #eed0c0;
  color: #000000;
}
#T_e89b0_row1_col9 {
  background-color: #93b5fe;
  color: #000000;
}
#T_e89b0_row1_col11, #T_e89b0_row8_col6 {
  background-color: #799cf8;
  color: #f1f1f1;
}
#T_e89b0_row2_col0, #T_e89b0_row10_col4 {
  background-color: #445acc;
  color: #f1f1f1;
}
#T_e89b0_row2_col2, #T_e89b0_row2_col11 {
  background-color: #506bda;
  color: #f1f1f1;
}
#T_e89b0_row2_col3 {
  background-color: #c5d6f2;
  color: #000000;
}
#T_e89b0_row2_col4, #T_e89b0_row4_col2, #T_e89b0_row8_col10 {
  background-color: #d5dbe5;
  color: #000000;
}
#T_e89b0_row2_col5 {
  background-color: #aec9fc;
  color: #000000;
}
#T_e89b0_row2_col7 {
  background-color: #97b8ff;
  color: #000000;
}
#T_e89b0_row2_col8 {
  background-color: #f4c5ad;
  color: #000000;
}
#T_e89b0_row2_col10 {
  background-color: #f7bca1;
  color: #000000;
}
#T_e89b0_row3_col1 {
  background-color: #81a4fb;
  color: #f1f1f1;
}
#T_e89b0_row3_col2 {
  background-color: #5572df;
  color: #f1f1f1;
}
#T_e89b0_row3_col3, #T_e89b0_row4_col3 {
  background-color: #455cce;
  color: #f1f1f1;
}
#T_e89b0_row3_col5, #T_e89b0_row4_col11 {
  background-color: #8badfd;
  color: #000000;
}
#T_e89b0_row3_col6 {
  background-color: #e0dbd8;
  color: #000000;
}
#T_e89b0_row3_col7, #T_e89b0_row4_col4 {
  background-color: #f6bfa6;
  color: #000000;
}
#T_e89b0_row3_col8 {
  background-color: #f7a889;
  color: #000000;
}
#T_e89b0_row3_col10 {
  background-color: #f59d7e;
  color: #000000;
}
#T_e89b0_row4_col0 {
  background-color: #7ea1fa;
  color: #f1f1f1;
}
#T_e89b0_row4_col1, #T_e89b0_row9_col8 {
  background-color: #a5c3fe;
  color: #000000;
}
#T_e89b0_row4_col5, #T_e89b0_row8_col5 {
  background-color: #abc8fd;
  color: #000000;
}
#T_e89b0_row4_col6, #T_e89b0_row6_col7 {
  background-color: #aac7fd;
  color: #000000;
}
#T_e89b0_row4_col9 {
  background-color: #3c4ec2;
  color: #f1f1f1;
}
#T_e89b0_row4_col10 {
  background-color: #f7b497;
  color: #000000;
}
#T_e89b0_row5_col0 {
  background-color: #82a6fb;
  color: #f1f1f1;
}
#T_e89b0_row5_col1, #T_e89b0_row11_col4 {
  background-color: #4a63d3;
  color: #f1f1f1;
}
#T_e89b0_row5_col5 {
  background-color: #7699f6;
  color: #f1f1f1;
}
#T_e89b0_row5_col6, #T_e89b0_row6_col8 {
  background-color: #ccd9ed;
  color: #000000;
}
#T_e89b0_row5_col8 {
  background-color: #f4c6af;
  color: #000000;
}
#T_e89b0_row5_col9, #T_e89b0_row9_col7 {
  background-color: #d1dae9;
  color: #000000;
}
#T_e89b0_row5_col11, #T_e89b0_row7_col9 {
  background-color: #7da0f9;
  color: #f1f1f1;
}
#T_e89b0_row6_col0 {
  background-color: #b9d0f9;
  color: #000000;
}
#T_e89b0_row6_col1 {
  background-color: #c4d5f3;
  color: #000000;
}
#T_e89b0_row6_col3 {
  background-color: #a6c4fe;
  color: #000000;
}
#T_e89b0_row6_col4, #T_e89b0_row11_col7, #T_e89b0_row11_col10 {
  background-color: #5e7de7;
  color: #f1f1f1;
}
#T_e89b0_row6_col6 {
  background-color: #89acfd;
  color: #000000;
}
#T_e89b0_row6_col9 {
  background-color: #5673e0;
  color: #f1f1f1;
}
#T_e89b0_row6_col10 {
  background-color: #b7cff9;
  color: #000000;
}
#T_e89b0_row7_col0 {
  background-color: #ead5c9;
  color: #000000;
}
#T_e89b0_row7_col3 {
  background-color: #6384eb;
  color: #f1f1f1;
}
#T_e89b0_row7_col4 {
  background-color: #8db0fe;
  color: #000000;
}
#T_e89b0_row7_col5, #T_e89b0_row8_col3 {
  background-color: #e7d7ce;
  color: #000000;
}
#T_e89b0_row7_col6, #T_e89b0_row9_col6 {
  background-color: #5f7fe8;
  color: #f1f1f1;
}
#T_e89b0_row7_col7 {
  background-color: #b1cbfc;
  color: #000000;
}
#T_e89b0_row7_col8, #T_e89b0_row7_col11 {
  background-color: #b6cefa;
  color: #000000;
}
#T_e89b0_row7_col10 {
  background-color: #afcafc;
  color: #000000;
}
#T_e89b0_row8_col1 {
  background-color: #96b7ff;
  color: #000000;
}
#T_e89b0_row8_col2, #T_e89b0_row10_col7 {
  background-color: #6c8ff1;
  color: #f1f1f1;
}
#T_e89b0_row8_col4 {
  background-color: #92b4fe;
  color: #000000;
}
#T_e89b0_row8_col11 {
  background-color: #5b7ae5;
  color: #f1f1f1;
}
#T_e89b0_row9_col0 {
  background-color: #f3c8b2;
  color: #000000;
}
#T_e89b0_row9_col1 {
  background-color: #e2dad5;
  color: #000000;
}
#T_e89b0_row9_col4 {
  background-color: #4e68d8;
  color: #f1f1f1;
}
#T_e89b0_row9_col5 {
  background-color: #e8d6cc;
  color: #000000;
}
#T_e89b0_row9_col10 {
  background-color: #9dbdff;
  color: #000000;
}
#T_e89b0_row9_col11 {
  background-color: #c7d7f0;
  color: #000000;
}
#T_e89b0_row10_col0 {
  background-color: #f5c0a7;
  color: #000000;
}
#T_e89b0_row10_col1 {
  background-color: #bbd1f8;
  color: #000000;
}
#T_e89b0_row10_col2 {
  background-color: #cbd8ee;
  color: #000000;
}
#T_e89b0_row10_col9 {
  background-color: #4358cb;
  color: #f1f1f1;
}
#T_e89b0_row10_col11 {
  background-color: #98b9ff;
  color: #000000;
}
#T_e89b0_row11_col1 {
  background-color: #d6dce4;
  color: #000000;
}
#T_e89b0_row11_col3 {
  background-color: #6e90f2;
  color: #f1f1f1;
}
#T_e89b0_row11_col5 {
  background-color: #f7b396;
  color: #000000;
}
#T_e89b0_row11_col8 {
  background-color: #6788ee;
  color: #f1f1f1;
}
#T_e89b0_row11_col9 {
  background-color: #cad8ef;
  color: #000000;
}
#T_e89b0_row11_col11 {
  background-color: #80a3fa;
  color: #f1f1f1;
}
</style>
<table id="T_e89b0">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_e89b0_level0_col0" class="col_heading level0 col0" >mean_scale_score</th>
      <th id="T_e89b0_level0_col1" class="col_heading level0 col1" >total_enrollment</th>
      <th id="T_e89b0_level0_col2" class="col_heading level0 col2" >asian_pct</th>
      <th id="T_e89b0_level0_col3" class="col_heading level0 col3" >black_pct</th>
      <th id="T_e89b0_level0_col4" class="col_heading level0 col4" >hispanic_pct</th>
      <th id="T_e89b0_level0_col5" class="col_heading level0 col5" >white_pct</th>
      <th id="T_e89b0_level0_col6" class="col_heading level0 col6" >swd_pct</th>
      <th id="T_e89b0_level0_col7" class="col_heading level0 col7" >ell_pct</th>
      <th id="T_e89b0_level0_col8" class="col_heading level0 col8" >poverty_pct</th>
      <th id="T_e89b0_level0_col9" class="col_heading level0 col9" >charter</th>
      <th id="T_e89b0_level0_col10" class="col_heading level0 col10" >eni_pct</th>
      <th id="T_e89b0_level0_col11" class="col_heading level0 col11" >geo_district</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_e89b0_level0_row0" class="row_heading level0 row0" >eni_pct</th>
      <td id="T_e89b0_row0_col0" class="data row0 col0" >-0.587185</td>
      <td id="T_e89b0_row0_col1" class="data row0 col1" >-0.169468</td>
      <td id="T_e89b0_row0_col2" class="data row0 col2" >-0.263891</td>
      <td id="T_e89b0_row0_col3" class="data row0 col3" >0.266915</td>
      <td id="T_e89b0_row0_col4" class="data row0 col4" >0.532394</td>
      <td id="T_e89b0_row0_col5" class="data row0 col5" >-0.797134</td>
      <td id="T_e89b0_row0_col6" class="data row0 col6" >0.380535</td>
      <td id="T_e89b0_row0_col7" class="data row0 col7" >0.420963</td>
      <td id="T_e89b0_row0_col8" class="data row0 col8" >0.954089</td>
      <td id="T_e89b0_row0_col9" class="data row0 col9" >0.048291</td>
      <td id="T_e89b0_row0_col10" class="data row0 col10" >1.000000</td>
      <td id="T_e89b0_row0_col11" class="data row0 col11" >-0.129043</td>
    </tr>
    <tr>
      <th id="T_e89b0_level0_row1" class="row_heading level0 row1" >poverty_pct</th>
      <td id="T_e89b0_row1_col0" class="data row1 col0" >-0.553455</td>
      <td id="T_e89b0_row1_col1" class="data row1 col1" >-0.143252</td>
      <td id="T_e89b0_row1_col2" class="data row1 col2" >-0.239338</td>
      <td id="T_e89b0_row1_col3" class="data row1 col3" >0.311367</td>
      <td id="T_e89b0_row1_col4" class="data row1 col4" >0.481236</td>
      <td id="T_e89b0_row1_col5" class="data row1 col5" >-0.814254</td>
      <td id="T_e89b0_row1_col6" class="data row1 col6" >0.317994</td>
      <td id="T_e89b0_row1_col7" class="data row1 col7" >0.398657</td>
      <td id="T_e89b0_row1_col8" class="data row1 col8" >1.000000</td>
      <td id="T_e89b0_row1_col9" class="data row1 col9" >0.092909</td>
      <td id="T_e89b0_row1_col10" class="data row1 col10" >0.954089</td>
      <td id="T_e89b0_row1_col11" class="data row1 col11" >-0.014550</td>
    </tr>
    <tr>
      <th id="T_e89b0_level0_row2" class="row_heading level0 row2" >swd_pct</th>
      <td id="T_e89b0_row2_col0" class="data row2 col0" >-0.536632</td>
      <td id="T_e89b0_row2_col1" class="data row2 col1" >-0.351879</td>
      <td id="T_e89b0_row2_col2" class="data row2 col2" >-0.353346</td>
      <td id="T_e89b0_row2_col3" class="data row2 col3" >0.136179</td>
      <td id="T_e89b0_row2_col4" class="data row2 col4" >0.249781</td>
      <td id="T_e89b0_row2_col5" class="data row2 col5" >-0.188203</td>
      <td id="T_e89b0_row2_col6" class="data row2 col6" >1.000000</td>
      <td id="T_e89b0_row2_col7" class="data row2 col7" >-0.023496</td>
      <td id="T_e89b0_row2_col8" class="data row2 col8" >0.317994</td>
      <td id="T_e89b0_row2_col9" class="data row2 col9" >-0.236692</td>
      <td id="T_e89b0_row2_col10" class="data row2 col10" >0.380535</td>
      <td id="T_e89b0_row2_col11" class="data row2 col11" >-0.165597</td>
    </tr>
    <tr>
      <th id="T_e89b0_level0_row3" class="row_heading level0 row3" >hispanic_pct</th>
      <td id="T_e89b0_row3_col0" class="data row3 col0" >-0.346844</td>
      <td id="T_e89b0_row3_col1" class="data row3 col1" >-0.060650</td>
      <td id="T_e89b0_row3_col2" class="data row3 col2" >-0.329082</td>
      <td id="T_e89b0_row3_col3" class="data row3 col3" >-0.419924</td>
      <td id="T_e89b0_row3_col4" class="data row3 col4" >1.000000</td>
      <td id="T_e89b0_row3_col5" class="data row3 col5" >-0.372532</td>
      <td id="T_e89b0_row3_col6" class="data row3 col6" >0.249781</td>
      <td id="T_e89b0_row3_col7" class="data row3 col7" >0.491201</td>
      <td id="T_e89b0_row3_col8" class="data row3 col8" >0.481236</td>
      <td id="T_e89b0_row3_col9" class="data row3 col9" >-0.043585</td>
      <td id="T_e89b0_row3_col10" class="data row3 col10" >0.532394</td>
      <td id="T_e89b0_row3_col11" class="data row3 col11" >-0.258318</td>
    </tr>
    <tr>
      <th id="T_e89b0_level0_row4" class="row_heading level0 row4" >ell_pct</th>
      <td id="T_e89b0_row4_col0" class="data row4 col0" >-0.258410</td>
      <td id="T_e89b0_row4_col1" class="data row4 col1" >0.078280</td>
      <td id="T_e89b0_row4_col2" class="data row4 col2" >0.224635</td>
      <td id="T_e89b0_row4_col3" class="data row4 col3" >-0.423411</td>
      <td id="T_e89b0_row4_col4" class="data row4 col4" >0.491201</td>
      <td id="T_e89b0_row4_col5" class="data row4 col5" >-0.199569</td>
      <td id="T_e89b0_row4_col6" class="data row4 col6" >-0.023496</td>
      <td id="T_e89b0_row4_col7" class="data row4 col7" >1.000000</td>
      <td id="T_e89b0_row4_col8" class="data row4 col8" >0.398657</td>
      <td id="T_e89b0_row4_col9" class="data row4 col9" >-0.231778</td>
      <td id="T_e89b0_row4_col10" class="data row4 col10" >0.420963</td>
      <td id="T_e89b0_row4_col11" class="data row4 col11" >0.049425</td>
    </tr>
    <tr>
      <th id="T_e89b0_level0_row5" class="row_heading level0 row5" >black_pct</th>
      <td id="T_e89b0_row5_col0" class="data row5 col0" >-0.235805</td>
      <td id="T_e89b0_row5_col1" class="data row5 col1" >-0.281028</td>
      <td id="T_e89b0_row5_col2" class="data row5 col2" >-0.459831</td>
      <td id="T_e89b0_row5_col3" class="data row5 col3" >1.000000</td>
      <td id="T_e89b0_row5_col4" class="data row5 col4" >-0.419924</td>
      <td id="T_e89b0_row5_col5" class="data row5 col5" >-0.476618</td>
      <td id="T_e89b0_row5_col6" class="data row5 col6" >0.136179</td>
      <td id="T_e89b0_row5_col7" class="data row5 col7" >-0.423411</td>
      <td id="T_e89b0_row5_col8" class="data row5 col8" >0.311367</td>
      <td id="T_e89b0_row5_col9" class="data row5 col9" >0.324027</td>
      <td id="T_e89b0_row5_col10" class="data row5 col10" >0.266915</td>
      <td id="T_e89b0_row5_col11" class="data row5 col11" >-0.001906</td>
    </tr>
    <tr>
      <th id="T_e89b0_level0_row6" class="row_heading level0 row6" >geo_district</th>
      <td id="T_e89b0_row6_col0" class="data row6 col0" >0.011835</td>
      <td id="T_e89b0_row6_col1" class="data row6 col1" >0.207157</td>
      <td id="T_e89b0_row6_col2" class="data row6 col2" >0.274706</td>
      <td id="T_e89b0_row6_col3" class="data row6 col3" >-0.001906</td>
      <td id="T_e89b0_row6_col4" class="data row6 col4" >-0.258318</td>
      <td id="T_e89b0_row6_col5" class="data row6 col5" >0.099406</td>
      <td id="T_e89b0_row6_col6" class="data row6 col6" >-0.165597</td>
      <td id="T_e89b0_row6_col7" class="data row6 col7" >0.049425</td>
      <td id="T_e89b0_row6_col8" class="data row6 col8" >-0.014550</td>
      <td id="T_e89b0_row6_col9" class="data row6 col9" >-0.124843</td>
      <td id="T_e89b0_row6_col10" class="data row6 col10" >-0.129043</td>
      <td id="T_e89b0_row6_col11" class="data row6 col11" >1.000000</td>
    </tr>
    <tr>
      <th id="T_e89b0_level0_row7" class="row_heading level0 row7" >total_enrollment</th>
      <td id="T_e89b0_row7_col0" class="data row7 col0" >0.288875</td>
      <td id="T_e89b0_row7_col1" class="data row7 col1" >1.000000</td>
      <td id="T_e89b0_row7_col2" class="data row7 col2" >0.354664</td>
      <td id="T_e89b0_row7_col3" class="data row7 col3" >-0.281028</td>
      <td id="T_e89b0_row7_col4" class="data row7 col4" >-0.060650</td>
      <td id="T_e89b0_row7_col5" class="data row7 col5" >0.169663</td>
      <td id="T_e89b0_row7_col6" class="data row7 col6" >-0.351879</td>
      <td id="T_e89b0_row7_col7" class="data row7 col7" >0.078280</td>
      <td id="T_e89b0_row7_col8" class="data row7 col8" >-0.143252</td>
      <td id="T_e89b0_row7_col9" class="data row7 col9" >0.018803</td>
      <td id="T_e89b0_row7_col10" class="data row7 col10" >-0.169468</td>
      <td id="T_e89b0_row7_col11" class="data row7 col11" >0.207157</td>
    </tr>
    <tr>
      <th id="T_e89b0_level0_row8" class="row_heading level0 row8" >charter</th>
      <td id="T_e89b0_row8_col0" class="data row8 col0" >0.298770</td>
      <td id="T_e89b0_row8_col1" class="data row8 col1" >0.018803</td>
      <td id="T_e89b0_row8_col2" class="data row8 col2" >-0.226191</td>
      <td id="T_e89b0_row8_col3" class="data row8 col3" >0.324027</td>
      <td id="T_e89b0_row8_col4" class="data row8 col4" >-0.043585</td>
      <td id="T_e89b0_row8_col5" class="data row8 col5" >-0.201707</td>
      <td id="T_e89b0_row8_col6" class="data row8 col6" >-0.236692</td>
      <td id="T_e89b0_row8_col7" class="data row8 col7" >-0.231778</td>
      <td id="T_e89b0_row8_col8" class="data row8 col8" >0.092909</td>
      <td id="T_e89b0_row8_col9" class="data row8 col9" >1.000000</td>
      <td id="T_e89b0_row8_col10" class="data row8 col10" >0.048291</td>
      <td id="T_e89b0_row8_col11" class="data row8 col11" >-0.124843</td>
    </tr>
    <tr>
      <th id="T_e89b0_level0_row9" class="row_heading level0 row9" >asian_pct</th>
      <td id="T_e89b0_row9_col0" class="data row9 col0" >0.382410</td>
      <td id="T_e89b0_row9_col1" class="data row9 col1" >0.354664</td>
      <td id="T_e89b0_row9_col2" class="data row9 col2" >1.000000</td>
      <td id="T_e89b0_row9_col3" class="data row9 col3" >-0.459831</td>
      <td id="T_e89b0_row9_col4" class="data row9 col4" >-0.329082</td>
      <td id="T_e89b0_row9_col5" class="data row9 col5" >0.177453</td>
      <td id="T_e89b0_row9_col6" class="data row9 col6" >-0.353346</td>
      <td id="T_e89b0_row9_col7" class="data row9 col7" >0.224635</td>
      <td id="T_e89b0_row9_col8" class="data row9 col8" >-0.239338</td>
      <td id="T_e89b0_row9_col9" class="data row9 col9" >-0.226191</td>
      <td id="T_e89b0_row9_col10" class="data row9 col10" >-0.263891</td>
      <td id="T_e89b0_row9_col11" class="data row9 col11" >0.274706</td>
    </tr>
    <tr>
      <th id="T_e89b0_level0_row10" class="row_heading level0 row10" >white_pct</th>
      <td id="T_e89b0_row10_col0" class="data row10 col0" >0.423773</td>
      <td id="T_e89b0_row10_col1" class="data row10 col1" >0.169663</td>
      <td id="T_e89b0_row10_col2" class="data row10 col2" >0.177453</td>
      <td id="T_e89b0_row10_col3" class="data row10 col3" >-0.476618</td>
      <td id="T_e89b0_row10_col4" class="data row10 col4" >-0.372532</td>
      <td id="T_e89b0_row10_col5" class="data row10 col5" >1.000000</td>
      <td id="T_e89b0_row10_col6" class="data row10 col6" >-0.188203</td>
      <td id="T_e89b0_row10_col7" class="data row10 col7" >-0.199569</td>
      <td id="T_e89b0_row10_col8" class="data row10 col8" >-0.814254</td>
      <td id="T_e89b0_row10_col9" class="data row10 col9" >-0.201707</td>
      <td id="T_e89b0_row10_col10" class="data row10 col10" >-0.797134</td>
      <td id="T_e89b0_row10_col11" class="data row10 col11" >0.099406</td>
    </tr>
    <tr>
      <th id="T_e89b0_level0_row11" class="row_heading level0 row11" >mean_scale_score</th>
      <td id="T_e89b0_row11_col0" class="data row11 col0" >1.000000</td>
      <td id="T_e89b0_row11_col1" class="data row11 col1" >0.288875</td>
      <td id="T_e89b0_row11_col2" class="data row11 col2" >0.382410</td>
      <td id="T_e89b0_row11_col3" class="data row11 col3" >-0.235805</td>
      <td id="T_e89b0_row11_col4" class="data row11 col4" >-0.346844</td>
      <td id="T_e89b0_row11_col5" class="data row11 col5" >0.423773</td>
      <td id="T_e89b0_row11_col6" class="data row11 col6" >-0.536632</td>
      <td id="T_e89b0_row11_col7" class="data row11 col7" >-0.258410</td>
      <td id="T_e89b0_row11_col8" class="data row11 col8" >-0.553455</td>
      <td id="T_e89b0_row11_col9" class="data row11 col9" >0.298770</td>
      <td id="T_e89b0_row11_col10" class="data row11 col10" >-0.587185</td>
      <td id="T_e89b0_row11_col11" class="data row11 col11" >0.011835</td>
    </tr>
  </tbody>
</table></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<p><strong>Scatter plots of correlations showing covariance of factors</strong></p>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/nb_04-Statistics_08-predictive-stats_5_3.png" src="../../_images/nb_04-Statistics_08-predictive-stats_5_3.png" />
</div>
</div>
</section>
</section>
<section id="OLS-Linear-Regression-with-different-factors">
<h2><span class="section-number">3.2. </span>OLS Linear Regression with different factors<a class="headerlink" href="#OLS-Linear-Regression-with-different-factors" title="Permalink to this heading"></a></h2>
<p>We’re going to run a linear regression prediction with several different sets of factors to see which combination creates the strongest predictive model.</p>
<p>Because the training and testing sets are randomized we will get slightly different results each time we run the code in this cell. It appears that the factors that total enrollment has no predictive power and that including poverty_pct without eni_pct produces slightly better predictions.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>

<span class="c1"># shuffle our data frame so test, train are randomized, but the same across runs</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># make a small function so that we can report r2 and mse for different factors</span>

<span class="k">def</span> <span class="nf">show_predict</span><span class="p">(</span><span class="n">factors</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">factors</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;mean_scale_score&#39;</span><span class="p">]</span>
    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">report</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">**</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">**</span>

<span class="s2">- factors: </span><span class="si">{</span><span class="n">factors</span><span class="si">}</span>
<span class="s2">- r2: </span><span class="si">{</span><span class="n">r2</span><span class="si">}</span>
<span class="s2">- rmse: </span><span class="si">{</span><span class="n">rmse</span><span class="si">}</span>
<span class="s2">&quot;&quot;&quot;</span>
    <span class="n">display</span><span class="p">(</span><span class="n">md</span><span class="p">(</span><span class="n">report</span><span class="p">))</span>

<span class="n">factors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;total_enrollment&#39;</span><span class="p">,</span> <span class="s1">&#39;asian_pct&#39;</span><span class="p">,</span><span class="s1">&#39;black_pct&#39;</span><span class="p">,</span>
           <span class="s1">&#39;hispanic_pct&#39;</span><span class="p">,</span>  <span class="s1">&#39;white_pct&#39;</span><span class="p">,</span><span class="s1">&#39;swd_pct&#39;</span><span class="p">,</span> <span class="s1">&#39;ell_pct&#39;</span><span class="p">,</span>
           <span class="s1">&#39;poverty_pct&#39;</span><span class="p">,</span> <span class="s1">&#39;charter&#39;</span><span class="p">]</span>
<span class="n">show_predict</span><span class="p">(</span><span class="n">factors</span><span class="p">,</span> <span class="s2">&quot;With total enrollment&quot;</span><span class="p">)</span>

<span class="n">factors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;asian_pct&#39;</span><span class="p">,</span><span class="s1">&#39;black_pct&#39;</span><span class="p">,</span>
       <span class="s1">&#39;hispanic_pct&#39;</span><span class="p">,</span>  <span class="s1">&#39;white_pct&#39;</span><span class="p">,</span><span class="s1">&#39;swd_pct&#39;</span><span class="p">,</span> <span class="s1">&#39;ell_pct&#39;</span><span class="p">,</span>  <span class="s1">&#39;poverty_pct&#39;</span><span class="p">,</span> <span class="s1">&#39;charter&#39;</span><span class="p">]</span>
<span class="n">show_predict</span><span class="p">(</span><span class="n">factors</span><span class="p">,</span> <span class="s2">&quot;Without total enrollment&quot;</span><span class="p">)</span>

<span class="n">factors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;asian_pct&#39;</span><span class="p">,</span><span class="s1">&#39;black_pct&#39;</span><span class="p">,</span>
       <span class="s1">&#39;hispanic_pct&#39;</span><span class="p">,</span>  <span class="s1">&#39;white_pct&#39;</span><span class="p">,</span><span class="s1">&#39;swd_pct&#39;</span><span class="p">,</span> <span class="s1">&#39;ell_pct&#39;</span><span class="p">,</span>  <span class="s1">&#39;poverty_pct&#39;</span><span class="p">,</span> <span class="s1">&#39;eni_pct&#39;</span><span class="p">,</span> <span class="s1">&#39;charter&#39;</span><span class="p">]</span>
<span class="n">show_predict</span><span class="p">(</span><span class="n">factors</span><span class="p">,</span> <span class="s2">&quot;Adding ENI&quot;</span> <span class="p">)</span>


<span class="n">factors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;asian_pct&#39;</span><span class="p">,</span><span class="s1">&#39;black_pct&#39;</span><span class="p">,</span>
       <span class="s1">&#39;hispanic_pct&#39;</span><span class="p">,</span>  <span class="s1">&#39;white_pct&#39;</span><span class="p">,</span><span class="s1">&#39;swd_pct&#39;</span><span class="p">,</span> <span class="s1">&#39;ell_pct&#39;</span><span class="p">,</span> <span class="s1">&#39;eni_pct&#39;</span><span class="p">,</span> <span class="s1">&#39;charter&#39;</span><span class="p">]</span>
<span class="n">show_predict</span><span class="p">(</span><span class="n">factors</span><span class="p">,</span> <span class="s2">&quot;ENI without Poverty %&quot;</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<p><strong>With total enrollment</strong></p>
<ul class="simple">
<li><p>factors: [‘total_enrollment’, ‘asian_pct’, ‘black_pct’, ‘hispanic_pct’, ‘white_pct’, ‘swd_pct’, ‘ell_pct’, ‘poverty_pct’, ‘charter’]</p></li>
<li><p>r2: 0.5924723906903767</p></li>
<li><p>rmse: 7.277398920596155</p></li>
</ul>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<p><strong>Without total enrollment</strong></p>
<ul class="simple">
<li><p>factors: [‘asian_pct’, ‘black_pct’, ‘hispanic_pct’, ‘white_pct’, ‘swd_pct’, ‘ell_pct’, ‘poverty_pct’, ‘charter’]</p></li>
<li><p>r2: 0.5919415599948159</p></li>
<li><p>rmse: 7.282137016235099</p></li>
</ul>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<p><strong>Adding ENI</strong></p>
<ul class="simple">
<li><p>factors: [‘asian_pct’, ‘black_pct’, ‘hispanic_pct’, ‘white_pct’, ‘swd_pct’, ‘ell_pct’, ‘poverty_pct’, ‘eni_pct’, ‘charter’]</p></li>
<li><p>r2: 0.5939385156228618</p></li>
<li><p>rmse: 7.264296508271085</p></li>
</ul>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<p><strong>ENI without Poverty %</strong></p>
<ul class="simple">
<li><p>factors: [‘asian_pct’, ‘black_pct’, ‘hispanic_pct’, ‘white_pct’, ‘swd_pct’, ‘ell_pct’, ‘eni_pct’, ‘charter’]</p></li>
<li><p>r2: 0.5927307982428955</p></li>
<li><p>rmse: 7.275091306338172</p></li>
</ul>
</div>
</div>
</section>
</section>
<section id="Partial-Least-Squares">
<h1><span class="section-number">4. </span>Partial Least Squares<a class="headerlink" href="#Partial-Least-Squares" title="Permalink to this heading"></a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">factors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;total_enrollment&#39;</span><span class="p">,</span> <span class="s1">&#39;asian_pct&#39;</span><span class="p">,</span><span class="s1">&#39;black_pct&#39;</span><span class="p">,</span>
           <span class="s1">&#39;hispanic_pct&#39;</span><span class="p">,</span>  <span class="s1">&#39;white_pct&#39;</span><span class="p">,</span><span class="s1">&#39;swd_pct&#39;</span><span class="p">,</span> <span class="s1">&#39;ell_pct&#39;</span><span class="p">,</span>
           <span class="s1">&#39;poverty_pct&#39;</span><span class="p">,</span> <span class="s1">&#39;charter&#39;</span><span class="p">]</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">factors</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;mean_scale_score&#39;</span><span class="p">]</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">pls</span> <span class="o">=</span> <span class="n">PLSRegression</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">factors</span><span class="p">))</span>
<span class="n">pls</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>


<span class="n">predictions</span> <span class="o">=</span> <span class="n">pls</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span>
<span class="n">rmse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">md</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">**PLS predict**</span>

<span class="s2">- factors: </span><span class="si">{</span><span class="n">factors</span><span class="si">}</span>
<span class="s2">- r2: </span><span class="si">{</span><span class="n">r2</span><span class="si">}</span>
<span class="s2">- rmse: </span><span class="si">{</span><span class="n">rmse</span><span class="si">}</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<p><strong>PLS predict</strong></p>
<ul class="simple">
<li><p>factors: [‘total_enrollment’, ‘asian_pct’, ‘black_pct’, ‘hispanic_pct’, ‘white_pct’, ‘swd_pct’, ‘ell_pct’, ‘poverty_pct’, ‘charter’]</p></li>
<li><p>r2: 0.5968590587532907</p></li>
<li><p>rmse: 7.211476927292283</p></li>
</ul>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># fit both models with the full data and show the correlations</span>
<span class="n">ols_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">pls_fit</span> <span class="o">=</span> <span class="n">pls</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="n">coef_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;factor&quot;</span><span class="p">,</span> <span class="s2">&quot;pls-coef&quot;</span><span class="p">,</span> <span class="s2">&quot;ols-coef&quot;</span><span class="p">])</span>

<span class="n">coef_table</span><span class="o">.</span><span class="n">factor</span> <span class="o">=</span> <span class="n">factors</span>

<span class="n">coef_table</span><span class="p">[</span><span class="s2">&quot;pls-coef&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pls</span><span class="o">.</span><span class="n">coef_</span><span class="p">]</span>
<span class="n">coef_table</span><span class="p">[</span><span class="s2">&quot;ols-coef&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">coef_</span><span class="p">]</span>

<span class="c1"># coef_table.join(ols_df, on=&quot;factor&quot;)</span>
<span class="n">coef_table</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>factor</th>
      <th>pls-coef</th>
      <th>ols-coef</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>total_enrollment</td>
      <td>0.292540</td>
      <td>0.000905</td>
    </tr>
    <tr>
      <th>1</th>
      <td>asian_pct</td>
      <td>3.938312</td>
      <td>22.357730</td>
    </tr>
    <tr>
      <th>2</th>
      <td>black_pct</td>
      <td>-0.235673</td>
      <td>-0.838275</td>
    </tr>
    <tr>
      <th>3</th>
      <td>hispanic_pct</td>
      <td>1.332454</td>
      <td>5.186641</td>
    </tr>
    <tr>
      <th>4</th>
      <td>white_pct</td>
      <td>1.870359</td>
      <td>9.845927</td>
    </tr>
    <tr>
      <th>5</th>
      <td>swd_pct</td>
      <td>-2.729158</td>
      <td>-39.616177</td>
    </tr>
    <tr>
      <th>6</th>
      <td>ell_pct</td>
      <td>-2.200350</td>
      <td>-18.667367</td>
    </tr>
    <tr>
      <th>7</th>
      <td>poverty_pct</td>
      <td>-2.956922</td>
      <td>-14.384679</td>
    </tr>
    <tr>
      <th>8</th>
      <td>charter</td>
      <td>3.905203</td>
      <td>10.371978</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># compare sklearn and statsmodel OLS</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;mean_scale_score&#39;</span><span class="p">]</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">factors</span><span class="p">]</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">sm_ols</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="n">params</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sm_ols</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
<span class="n">coefs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sm_ols</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">:],)</span>
<span class="n">pvalues</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sm_ols</span><span class="o">.</span><span class="n">pvalues</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
<span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">coefs</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">pvalues</span><span class="p">)</span>
<span class="n">pvalues</span>
<span class="n">ols_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;factor&quot;</span><span class="p">:</span><span class="n">params</span><span class="p">,</span><span class="s2">&quot;sm-coef&quot;</span><span class="p">:</span><span class="n">coefs</span><span class="p">,</span><span class="s2">&quot;p-values&quot;</span><span class="p">:</span><span class="n">pvalues</span><span class="p">})</span>
<span class="c1"># ols_df</span>
<span class="n">coef_table</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">ols_df</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="s2">&quot;factor&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>factor</th>
      <th>pls-coef</th>
      <th>ols-coef</th>
      <th>sm-coef</th>
      <th>p-values</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>total_enrollment</td>
      <td>0.292540</td>
      <td>0.000905</td>
      <td>0.000905</td>
      <td>4.759245e-03</td>
    </tr>
    <tr>
      <th>1</th>
      <td>asian_pct</td>
      <td>3.938312</td>
      <td>22.357730</td>
      <td>22.357730</td>
      <td>4.136083e-08</td>
    </tr>
    <tr>
      <th>2</th>
      <td>black_pct</td>
      <td>-0.235673</td>
      <td>-0.838275</td>
      <td>-0.838275</td>
      <td>8.343130e-01</td>
    </tr>
    <tr>
      <th>3</th>
      <td>hispanic_pct</td>
      <td>1.332454</td>
      <td>5.186641</td>
      <td>5.186641</td>
      <td>1.930317e-01</td>
    </tr>
    <tr>
      <th>4</th>
      <td>white_pct</td>
      <td>1.870359</td>
      <td>9.845927</td>
      <td>9.845927</td>
      <td>1.196722e-02</td>
    </tr>
    <tr>
      <th>5</th>
      <td>swd_pct</td>
      <td>-2.729158</td>
      <td>-39.616177</td>
      <td>-39.616177</td>
      <td>2.500699e-119</td>
    </tr>
    <tr>
      <th>6</th>
      <td>ell_pct</td>
      <td>-2.200350</td>
      <td>-18.667367</td>
      <td>-18.667367</td>
      <td>5.892349e-59</td>
    </tr>
    <tr>
      <th>7</th>
      <td>poverty_pct</td>
      <td>-2.956922</td>
      <td>-14.384679</td>
      <td>-14.384679</td>
      <td>5.709181e-46</td>
    </tr>
    <tr>
      <th>8</th>
      <td>charter</td>
      <td>3.905203</td>
      <td>10.371978</td>
      <td>10.371978</td>
      <td>4.740549e-265</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># let&#39;s get p-values for the sklearn models</span>
<span class="n">pls_intercept</span> <span class="o">=</span> <span class="n">y_intercept</span> <span class="o">=</span> <span class="n">pls_fit</span><span class="o">.</span><span class="n">_y_mean</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">pls_fit</span><span class="o">.</span><span class="n">_x_mean</span> <span class="p">,</span> <span class="n">pls_fit</span><span class="o">.</span><span class="n">coef_</span><span class="p">)</span>
<span class="n">pls_intercept</span> <span class="o">=</span> <span class="n">pls_intercept</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">pls_intercept</span>
<span class="n">pls_coef</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pls</span><span class="o">.</span><span class="n">coef_</span><span class="p">]</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">factors</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;mean_scale_score&#39;</span><span class="p">]</span>
<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>


<span class="n">beta_hat</span> <span class="o">=</span> <span class="p">[</span><span class="n">pls_intercept</span><span class="p">]</span> <span class="o">+</span> <span class="n">pls_coef</span>
<span class="n">beta_hat</span>


<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">t</span>
<span class="n">X1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">X</span><span class="p">))</span>
<span class="c1"># standard deviation of the noise.</span>
<span class="n">sigma_hat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">X1</span><span class="nd">@beta_hat</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">X1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="c1"># estimate the covariance matrix for beta</span>
<span class="n">beta_cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">X1</span><span class="o">.</span><span class="n">T</span><span class="nd">@X1</span><span class="p">)</span>
<span class="c1"># the t-test statistic for each variable from the formula from above figure</span>
<span class="n">t_vals</span> <span class="o">=</span> <span class="n">beta_hat</span> <span class="o">/</span> <span class="p">(</span><span class="n">sigma_hat</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diagonal</span><span class="p">(</span><span class="n">beta_cov</span><span class="p">)))</span>
<span class="c1"># compute 2-sided p-values.</span>
<span class="n">p_vals</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t_vals</span><span class="p">),</span> <span class="n">n</span><span class="o">-</span><span class="n">X1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="mi">2</span>
<span class="n">t_vals</span>
<span class="c1"># array([ 0.37424023, -2.36373529,  3.57930174])</span>
<span class="n">p_vals</span>
<br/><br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([2.07183903e-19, 0.00000000e+00, 9.40071536e-01, 9.96353400e-01,
       9.79264969e-01, 9.70396004e-01, 8.98851951e-01, 8.80842705e-01,
       8.18668445e-01, 2.84814328e-01])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">md</span><span class="p">(</span><span class="s2">&quot;### Graph of PLS coefficients&quot;</span><span class="p">))</span>
<span class="n">coefs</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pls</span><span class="o">.</span><span class="n">coef_</span><span class="p">]</span>
<span class="n">ui</span><span class="o">.</span><span class="n">network_map</span><span class="p">(</span><span class="s2">&quot;mean_scale_score&quot;</span><span class="p">,</span> <span class="n">factors</span><span class="p">,</span> <span class="n">coefs</span> <span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">md</span><span class="p">(</span><span class="s2">&quot;### Graph of OLS coefficients&quot;</span><span class="p">))</span>
<span class="n">coefs</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">coef_</span><span class="p">]</span>
<span class="n">ui</span><span class="o">.</span><span class="n">network_map</span><span class="p">(</span><span class="s2">&quot;mean_scale_score&quot;</span><span class="p">,</span> <span class="n">factors</span><span class="p">,</span> <span class="n">coefs</span> <span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<section id="Graph-of-PLS-coefficients">
<h2><span class="section-number">3. </span>Graph of PLS coefficients<a class="headerlink" href="#Graph-of-PLS-coefficients" title="Permalink to this heading"></a></h2>
</section>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/nb_04-Statistics_08-predictive-stats_13_1.png" src="../../_images/nb_04-Statistics_08-predictive-stats_13_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<section id="Graph-of-OLS-coefficients">
<h2><span class="section-number">3. </span>Graph of OLS coefficients<a class="headerlink" href="#Graph-of-OLS-coefficients" title="Permalink to this heading"></a></h2>
</section>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/nb_04-Statistics_08-predictive-stats_13_3.png" src="../../_images/nb_04-Statistics_08-predictive-stats_13_3.png" />
</div>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="05-anova-ols.html" class="btn btn-neutral float-left" title="2. ANOVA and OLS Regression" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../05-Maps-and-GIS/index.html" class="btn btn-neutral float-right" title="Maps &amp; GIS" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Matthew X. Curinga.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>