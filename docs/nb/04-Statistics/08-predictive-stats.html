
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Predictive Statistics &#8212; NYC Schools Open Data Portal</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Introduction to Maps and Spatial Data" href="../05-Maps-and-GIS/01-maps-intro.html" />
    <link rel="prev" title="ANOVA and OLS Regression" href="05-anova-ols.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo2.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">NYC Schools Open Data Portal</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    NYC Schools Open Data Portal
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Installing
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../install-colab.html">
   Installing in Google Colab
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../install.html">
   Installing Locally
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../install-dev.html">
   Development Install
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Getting Started
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../01-Basics/01-loading-data.html">
   Loading Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../01-Basics/02-querying-data.html">
   Querying &amp; Selecting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../01-Basics/03-basic-stats.html">
   Basic Statistics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../01-Basics/04-calculating-columns.html">
   Calculating New Columns
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Combining Data
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../02-Combining-Data/01-group-and-agg.html">
   Groups &amp; Aggregates
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../02-Combining-Data/02-merge-and-join.html">
   Merges &amp; Joins
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Graphs and Charts
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../03-Graphs-and-Charts/01-basic-bar-charts.html">
   Bar Charts
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../03-Graphs-and-Charts/02-grouped-bar-chart.html">
   Grouped Bar Charts
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../03-Graphs-and-Charts/03-line-and-scatter-charts.html">
   Line &amp; Scatter Plots
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Statistics
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="04-t_tests.html">
   T Tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05-anova-ols.html">
   ANOVA and OLS Regression
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Predictive Statistics
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Maps and GIS
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../05-Maps-and-GIS/01-maps-intro.html">
   Introduction to Maps and Spatial Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../05-Maps-and-GIS/02-mapping-schools.html">
   Layered Maps
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Reference
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../api/nycschools.html">
   API Documentation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../data-sources.html">
   Data Sources
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  About NYC Schools
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../about.html">
   About Us
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://colab.research.google.com/github/adelphi-ed-tech/nycschools/blob/main/book/nb/04-Statistics/08-predictive-stats.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/adelphi-ed-tech/nycschools"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/adelphi-ed-tech/nycschools/issues/new?title=Issue%20on%20page%20%2Fnb/04-Statistics/08-predictive-stats.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/nb/04-Statistics/08-predictive-stats.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Predictive Statistics
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#predicting-test-scores">
     Predicting test scores
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#correlation-table">
       Correlation table
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ols-linear-regression-with-different-factors">
     OLS Linear Regression with different factors
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#partial-least-squares">
   Partial Least Squares
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Predictive Statistics</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Predictive Statistics
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#predicting-test-scores">
     Predicting test scores
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#correlation-table">
       Correlation table
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ols-linear-regression-with-different-factors">
     OLS Linear Regression with different factors
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#partial-least-squares">
   Partial Least Squares
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="predictive-statistics">
<h1>Predictive Statistics<a class="headerlink" href="#predictive-statistics" title="Permalink to this headline">#</a></h1>
<p>This notebook uses the <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> library to run some machine learning
predictions using regression analysis. It has examples of both
Ordinary Least Square and Partial Least Square Regression.</p>
<p>We look at school demographics to see how well we can use those factors
to predict mean_scale_score. We look at the grades 3-8 NYS math exams
for the most recent academic year in our data set.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">r2_score</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">scale</span> 
<span class="kn">from</span> <span class="nn">sklearn.cross_decomposition</span> <span class="kn">import</span> <span class="n">PLSRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="kn">import</span> <span class="n">chi2</span>

<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Markdown</span> <span class="k">as</span> <span class="n">md</span>

<span class="kn">from</span> <span class="nn">nycschools</span> <span class="kn">import</span> <span class="n">schools</span><span class="p">,</span> <span class="n">ui</span><span class="p">,</span> <span class="n">exams</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load the demographic data and merge it with the math data</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">schools</span><span class="o">.</span><span class="n">load_school_demographics</span><span class="p">()</span>

<span class="n">math_df</span> <span class="o">=</span> <span class="n">exams</span><span class="o">.</span><span class="n">load_math</span><span class="p">()</span>

<span class="n">math_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">math_df</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;dbn&quot;</span><span class="p">,</span> <span class="s2">&quot;ay&quot;</span><span class="p">])</span>
<span class="n">math_df</span> <span class="o">=</span> <span class="n">math_df</span><span class="p">[</span><span class="n">math_df</span><span class="p">[</span><span class="s2">&quot;mean_scale_score&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span>
<span class="n">math_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>dbn</th>
      <th>beds</th>
      <th>district</th>
      <th>geo_district</th>
      <th>boro</th>
      <th>school_name_x</th>
      <th>short_name</th>
      <th>ay</th>
      <th>year</th>
      <th>total_enrollment</th>
      <th>...</th>
      <th>level_2_pct</th>
      <th>level_3_n</th>
      <th>level_3_pct</th>
      <th>level_4_n</th>
      <th>level_4_pct</th>
      <th>level_3_4_n</th>
      <th>level_3_4_pct</th>
      <th>test_year</th>
      <th>charter</th>
      <th>school_name_y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>01M015</td>
      <td>310100010015</td>
      <td>1</td>
      <td>1</td>
      <td>Manhattan</td>
      <td>P.S. 015 Roberto Clemente</td>
      <td>PS 15</td>
      <td>2016</td>
      <td>2016-17</td>
      <td>178</td>
      <td>...</td>
      <td>0.310345</td>
      <td>7.0</td>
      <td>0.241379</td>
      <td>5.0</td>
      <td>0.172414</td>
      <td>12.0</td>
      <td>0.413793</td>
      <td>2017</td>
      <td>0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>01M015</td>
      <td>310100010015</td>
      <td>1</td>
      <td>1</td>
      <td>Manhattan</td>
      <td>P.S. 015 Roberto Clemente</td>
      <td>PS 15</td>
      <td>2016</td>
      <td>2016-17</td>
      <td>178</td>
      <td>...</td>
      <td>0.347826</td>
      <td>8.0</td>
      <td>0.347826</td>
      <td>1.0</td>
      <td>0.043478</td>
      <td>9.0</td>
      <td>0.391304</td>
      <td>2017</td>
      <td>0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>01M015</td>
      <td>310100010015</td>
      <td>1</td>
      <td>1</td>
      <td>Manhattan</td>
      <td>P.S. 015 Roberto Clemente</td>
      <td>PS 15</td>
      <td>2016</td>
      <td>2016-17</td>
      <td>178</td>
      <td>...</td>
      <td>0.294118</td>
      <td>8.0</td>
      <td>0.470588</td>
      <td>2.0</td>
      <td>0.117647</td>
      <td>10.0</td>
      <td>0.588235</td>
      <td>2017</td>
      <td>0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>01M015</td>
      <td>310100010015</td>
      <td>1</td>
      <td>1</td>
      <td>Manhattan</td>
      <td>P.S. 015 Roberto Clemente</td>
      <td>PS 15</td>
      <td>2016</td>
      <td>2016-17</td>
      <td>178</td>
      <td>...</td>
      <td>0.318841</td>
      <td>23.0</td>
      <td>0.333333</td>
      <td>8.0</td>
      <td>0.115942</td>
      <td>31.0</td>
      <td>0.449275</td>
      <td>2017</td>
      <td>0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>01M015</td>
      <td>310100010015</td>
      <td>1</td>
      <td>1</td>
      <td>Manhattan</td>
      <td>P.S. 015 Roberto Clemente</td>
      <td>PS 15</td>
      <td>2016</td>
      <td>2016-17</td>
      <td>178</td>
      <td>...</td>
      <td>0.391304</td>
      <td>6.0</td>
      <td>0.260870</td>
      <td>4.0</td>
      <td>0.173913</td>
      <td>10.0</td>
      <td>0.434783</td>
      <td>2017</td>
      <td>0</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 68 columns</p>
</div></div></div>
</div>
<section id="predicting-test-scores">
<h2>Predicting test scores<a class="headerlink" href="#predicting-test-scores" title="Permalink to this headline">#</a></h2>
<p>Using OLS regression we will see how well we can predict mean_scale_score for the
“All Students” category. We will run this with several variations of factors
to see which factors have the strongest prediction.</p>
<p>The basic ideas of a predictive model is that we will use some of our data to
“train” the model and use the other portion to “test” the model. Once we
calculate a coeefficient for each factor, we can use those values to
adjust the data sets mean score for a particular case.</p>
<p>These examples will use two statistical measures to compare our models:</p>
<ul class="simple">
<li><p>r-squared is a number between 0 and 1 that will tell us how closely our predictions
match the actual recorded score (1 is perfect, 0 is no matches)</p></li>
<li><p>mean squared error (<code class="docutils literal notranslate"><span class="pre">rmse</span></code>) tells us the mean distance between predictions and recorded scores
in the same scale as our exam; so an rmse of 10 means that, on average, our predictions were
10 points away from the actual score</p></li>
</ul>
<section id="correlation-table">
<h3>Correlation table<a class="headerlink" href="#correlation-table" title="Permalink to this headline">#</a></h3>
<p>First, let’s see how the factors correlate with each other, and with our
dependent variable. This table uses a “coolwarm” color map. Darker red
indicates a strong positive correlation and darker blue a strong negative correlation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get just the 2019 test results for All Students</span>
<span class="c1"># this will be the dependent variable in our regression</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">math_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ay == </span><span class="si">{</span><span class="n">math_df</span><span class="o">.</span><span class="n">ay</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2"> and category == &#39;All Students&#39;&quot;</span><span class="p">)</span>
<span class="c1"># calculate coefficients for these factors</span>
<span class="n">factors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;total_enrollment&#39;</span><span class="p">,</span> <span class="s1">&#39;asian_pct&#39;</span><span class="p">,</span><span class="s1">&#39;black_pct&#39;</span><span class="p">,</span> 
       <span class="s1">&#39;hispanic_pct&#39;</span><span class="p">,</span>  <span class="s1">&#39;white_pct&#39;</span><span class="p">,</span><span class="s1">&#39;swd_pct&#39;</span><span class="p">,</span> <span class="s1">&#39;ell_pct&#39;</span><span class="p">,</span>  
       <span class="s1">&#39;poverty_pct&#39;</span><span class="p">,</span> <span class="s1">&#39;charter&#39;</span><span class="p">,</span> <span class="s2">&quot;eni_pct&quot;</span><span class="p">,</span> <span class="s2">&quot;geo_district&quot;</span><span class="p">]</span>


<span class="n">dv_stats</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">mean_scale_score</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
<span class="n">display</span><span class="p">(</span><span class="n">md</span><span class="p">(</span><span class="s2">&quot;**Descriptive statistics for mean scale score**&quot;</span><span class="p">))</span>

<span class="n">display</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dv_stats</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<p><strong>Descriptive statistics for mean scale score</strong></p>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean_scale_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>6194.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>600.830675</td>
    </tr>
    <tr>
      <th>std</th>
      <td>11.344600</td>
    </tr>
    <tr>
      <th>min</th>
      <td>565.111084</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>592.223618</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>599.833649</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>608.619659</td>
    </tr>
    <tr>
      <th>max</th>
      <td>639.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s2">&quot;mean_scale_score&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">factors</span><span class="p">]</span>
<span class="n">data</span><span class="o">.</span><span class="n">charter</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">charter</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">x</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">corr</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;mean_scale_score&quot;</span><span class="p">)</span>
<span class="n">corr</span> <span class="o">=</span> <span class="n">corr</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">background_gradient</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">coolwarm</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">md</span><span class="p">(</span><span class="s2">&quot;**Correlation table between factors and mean scale score**&quot;</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">corr</span><span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">md</span><span class="p">(</span><span class="s2">&quot;**Scatter plots of correlations showing covariance of factors**&quot;</span><span class="p">))</span>

<span class="n">sns</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">factors</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<p><strong>Correlation table between factors and mean scale score</strong></p>
<div class="output text_html"><style type="text/css">
#T_798b9_row0_col0, #T_798b9_row1_col5, #T_798b9_row2_col1, #T_798b9_row2_col9, #T_798b9_row3_col11, #T_798b9_row5_col2, #T_798b9_row5_col4, #T_798b9_row5_col7, #T_798b9_row10_col3, #T_798b9_row10_col8, #T_798b9_row10_col10, #T_798b9_row11_col6 {
  background-color: #3b4cc0;
  color: #f1f1f1;
}
#T_798b9_row0_col1, #T_798b9_row0_col2, #T_798b9_row8_col7 {
  background-color: #6485ec;
  color: #f1f1f1;
}
#T_798b9_row0_col3, #T_798b9_row6_col2, #T_798b9_row6_col5, #T_798b9_row8_col8 {
  background-color: #dddcdc;
  color: #000000;
}
#T_798b9_row0_col4, #T_798b9_row4_col8 {
  background-color: #f7b79b;
  color: #000000;
}
#T_798b9_row0_col5, #T_798b9_row9_col3, #T_798b9_row9_col9 {
  background-color: #3d50c3;
  color: #f1f1f1;
}
#T_798b9_row0_col6 {
  background-color: #f1ccb8;
  color: #000000;
}
#T_798b9_row0_col7, #T_798b9_row5_col10 {
  background-color: #f1cdba;
  color: #000000;
}
#T_798b9_row0_col8, #T_798b9_row1_col10 {
  background-color: #bd1f2d;
  color: #f1f1f1;
}
#T_798b9_row0_col9, #T_798b9_row10_col6 {
  background-color: #85a8fc;
  color: #f1f1f1;
}
#T_798b9_row0_col10, #T_798b9_row1_col8, #T_798b9_row2_col6, #T_798b9_row3_col4, #T_798b9_row4_col7, #T_798b9_row5_col3, #T_798b9_row6_col11, #T_798b9_row7_col1, #T_798b9_row8_col9, #T_798b9_row9_col2, #T_798b9_row10_col5, #T_798b9_row11_col0 {
  background-color: #b40426;
  color: #f1f1f1;
}
#T_798b9_row0_col11 {
  background-color: #5a78e4;
  color: #f1f1f1;
}
#T_798b9_row1_col0 {
  background-color: #4055c8;
  color: #f1f1f1;
}
#T_798b9_row1_col1, #T_798b9_row3_col9 {
  background-color: #6b8df0;
  color: #f1f1f1;
}
#T_798b9_row1_col2, #T_798b9_row3_col0 {
  background-color: #6a8bef;
  color: #f1f1f1;
}
#T_798b9_row1_col3 {
  background-color: #e5d8d1;
  color: #000000;
}
#T_798b9_row1_col4 {
  background-color: #f5c1a9;
  color: #000000;
}
#T_798b9_row1_col6, #T_798b9_row7_col2, #T_798b9_row8_col0 {
  background-color: #ead4c8;
  color: #000000;
}
#T_798b9_row1_col7, #T_798b9_row11_col2 {
  background-color: #eed0c0;
  color: #000000;
}
#T_798b9_row1_col9 {
  background-color: #93b5fe;
  color: #000000;
}
#T_798b9_row1_col11, #T_798b9_row8_col6 {
  background-color: #799cf8;
  color: #f1f1f1;
}
#T_798b9_row2_col0, #T_798b9_row10_col4 {
  background-color: #445acc;
  color: #f1f1f1;
}
#T_798b9_row2_col2, #T_798b9_row2_col11 {
  background-color: #506bda;
  color: #f1f1f1;
}
#T_798b9_row2_col3 {
  background-color: #c5d6f2;
  color: #000000;
}
#T_798b9_row2_col4, #T_798b9_row4_col2, #T_798b9_row8_col10 {
  background-color: #d5dbe5;
  color: #000000;
}
#T_798b9_row2_col5 {
  background-color: #aec9fc;
  color: #000000;
}
#T_798b9_row2_col7 {
  background-color: #97b8ff;
  color: #000000;
}
#T_798b9_row2_col8 {
  background-color: #f4c5ad;
  color: #000000;
}
#T_798b9_row2_col10 {
  background-color: #f7bca1;
  color: #000000;
}
#T_798b9_row3_col1 {
  background-color: #81a4fb;
  color: #f1f1f1;
}
#T_798b9_row3_col2 {
  background-color: #5572df;
  color: #f1f1f1;
}
#T_798b9_row3_col3, #T_798b9_row4_col3 {
  background-color: #455cce;
  color: #f1f1f1;
}
#T_798b9_row3_col5, #T_798b9_row4_col11 {
  background-color: #8badfd;
  color: #000000;
}
#T_798b9_row3_col6 {
  background-color: #e0dbd8;
  color: #000000;
}
#T_798b9_row3_col7, #T_798b9_row4_col4 {
  background-color: #f6bfa6;
  color: #000000;
}
#T_798b9_row3_col8 {
  background-color: #f7a889;
  color: #000000;
}
#T_798b9_row3_col10 {
  background-color: #f59d7e;
  color: #000000;
}
#T_798b9_row4_col0 {
  background-color: #7ea1fa;
  color: #f1f1f1;
}
#T_798b9_row4_col1, #T_798b9_row9_col8 {
  background-color: #a5c3fe;
  color: #000000;
}
#T_798b9_row4_col5, #T_798b9_row8_col5 {
  background-color: #abc8fd;
  color: #000000;
}
#T_798b9_row4_col6, #T_798b9_row6_col7 {
  background-color: #aac7fd;
  color: #000000;
}
#T_798b9_row4_col9 {
  background-color: #3c4ec2;
  color: #f1f1f1;
}
#T_798b9_row4_col10 {
  background-color: #f7b497;
  color: #000000;
}
#T_798b9_row5_col0 {
  background-color: #82a6fb;
  color: #f1f1f1;
}
#T_798b9_row5_col1, #T_798b9_row11_col4 {
  background-color: #4a63d3;
  color: #f1f1f1;
}
#T_798b9_row5_col5 {
  background-color: #7699f6;
  color: #f1f1f1;
}
#T_798b9_row5_col6, #T_798b9_row6_col8 {
  background-color: #ccd9ed;
  color: #000000;
}
#T_798b9_row5_col8 {
  background-color: #f4c6af;
  color: #000000;
}
#T_798b9_row5_col9, #T_798b9_row9_col7 {
  background-color: #d1dae9;
  color: #000000;
}
#T_798b9_row5_col11, #T_798b9_row7_col9 {
  background-color: #7da0f9;
  color: #f1f1f1;
}
#T_798b9_row6_col0 {
  background-color: #b9d0f9;
  color: #000000;
}
#T_798b9_row6_col1 {
  background-color: #c4d5f3;
  color: #000000;
}
#T_798b9_row6_col3 {
  background-color: #a6c4fe;
  color: #000000;
}
#T_798b9_row6_col4, #T_798b9_row11_col7, #T_798b9_row11_col10 {
  background-color: #5e7de7;
  color: #f1f1f1;
}
#T_798b9_row6_col6 {
  background-color: #89acfd;
  color: #000000;
}
#T_798b9_row6_col9 {
  background-color: #5673e0;
  color: #f1f1f1;
}
#T_798b9_row6_col10 {
  background-color: #b7cff9;
  color: #000000;
}
#T_798b9_row7_col0 {
  background-color: #ead5c9;
  color: #000000;
}
#T_798b9_row7_col3 {
  background-color: #6384eb;
  color: #f1f1f1;
}
#T_798b9_row7_col4 {
  background-color: #8db0fe;
  color: #000000;
}
#T_798b9_row7_col5, #T_798b9_row8_col3 {
  background-color: #e7d7ce;
  color: #000000;
}
#T_798b9_row7_col6, #T_798b9_row9_col6 {
  background-color: #5f7fe8;
  color: #f1f1f1;
}
#T_798b9_row7_col7 {
  background-color: #b1cbfc;
  color: #000000;
}
#T_798b9_row7_col8, #T_798b9_row7_col11 {
  background-color: #b6cefa;
  color: #000000;
}
#T_798b9_row7_col10 {
  background-color: #afcafc;
  color: #000000;
}
#T_798b9_row8_col1 {
  background-color: #96b7ff;
  color: #000000;
}
#T_798b9_row8_col2, #T_798b9_row10_col7 {
  background-color: #6c8ff1;
  color: #f1f1f1;
}
#T_798b9_row8_col4 {
  background-color: #92b4fe;
  color: #000000;
}
#T_798b9_row8_col11 {
  background-color: #5b7ae5;
  color: #f1f1f1;
}
#T_798b9_row9_col0 {
  background-color: #f3c8b2;
  color: #000000;
}
#T_798b9_row9_col1 {
  background-color: #e2dad5;
  color: #000000;
}
#T_798b9_row9_col4 {
  background-color: #4e68d8;
  color: #f1f1f1;
}
#T_798b9_row9_col5 {
  background-color: #e8d6cc;
  color: #000000;
}
#T_798b9_row9_col10 {
  background-color: #9dbdff;
  color: #000000;
}
#T_798b9_row9_col11 {
  background-color: #c7d7f0;
  color: #000000;
}
#T_798b9_row10_col0 {
  background-color: #f5c0a7;
  color: #000000;
}
#T_798b9_row10_col1 {
  background-color: #bbd1f8;
  color: #000000;
}
#T_798b9_row10_col2 {
  background-color: #cbd8ee;
  color: #000000;
}
#T_798b9_row10_col9 {
  background-color: #4358cb;
  color: #f1f1f1;
}
#T_798b9_row10_col11 {
  background-color: #98b9ff;
  color: #000000;
}
#T_798b9_row11_col1 {
  background-color: #d6dce4;
  color: #000000;
}
#T_798b9_row11_col3 {
  background-color: #6e90f2;
  color: #f1f1f1;
}
#T_798b9_row11_col5 {
  background-color: #f7b396;
  color: #000000;
}
#T_798b9_row11_col8 {
  background-color: #6788ee;
  color: #f1f1f1;
}
#T_798b9_row11_col9 {
  background-color: #cad8ef;
  color: #000000;
}
#T_798b9_row11_col11 {
  background-color: #80a3fa;
  color: #f1f1f1;
}
</style>
<table id="T_798b9">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_798b9_level0_col0" class="col_heading level0 col0" >mean_scale_score</th>
      <th id="T_798b9_level0_col1" class="col_heading level0 col1" >total_enrollment</th>
      <th id="T_798b9_level0_col2" class="col_heading level0 col2" >asian_pct</th>
      <th id="T_798b9_level0_col3" class="col_heading level0 col3" >black_pct</th>
      <th id="T_798b9_level0_col4" class="col_heading level0 col4" >hispanic_pct</th>
      <th id="T_798b9_level0_col5" class="col_heading level0 col5" >white_pct</th>
      <th id="T_798b9_level0_col6" class="col_heading level0 col6" >swd_pct</th>
      <th id="T_798b9_level0_col7" class="col_heading level0 col7" >ell_pct</th>
      <th id="T_798b9_level0_col8" class="col_heading level0 col8" >poverty_pct</th>
      <th id="T_798b9_level0_col9" class="col_heading level0 col9" >charter</th>
      <th id="T_798b9_level0_col10" class="col_heading level0 col10" >eni_pct</th>
      <th id="T_798b9_level0_col11" class="col_heading level0 col11" >geo_district</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_798b9_level0_row0" class="row_heading level0 row0" >eni_pct</th>
      <td id="T_798b9_row0_col0" class="data row0 col0" >-0.587185</td>
      <td id="T_798b9_row0_col1" class="data row0 col1" >-0.169468</td>
      <td id="T_798b9_row0_col2" class="data row0 col2" >-0.263891</td>
      <td id="T_798b9_row0_col3" class="data row0 col3" >0.266915</td>
      <td id="T_798b9_row0_col4" class="data row0 col4" >0.532394</td>
      <td id="T_798b9_row0_col5" class="data row0 col5" >-0.797134</td>
      <td id="T_798b9_row0_col6" class="data row0 col6" >0.380535</td>
      <td id="T_798b9_row0_col7" class="data row0 col7" >0.420963</td>
      <td id="T_798b9_row0_col8" class="data row0 col8" >0.954089</td>
      <td id="T_798b9_row0_col9" class="data row0 col9" >0.048291</td>
      <td id="T_798b9_row0_col10" class="data row0 col10" >1.000000</td>
      <td id="T_798b9_row0_col11" class="data row0 col11" >-0.129043</td>
    </tr>
    <tr>
      <th id="T_798b9_level0_row1" class="row_heading level0 row1" >poverty_pct</th>
      <td id="T_798b9_row1_col0" class="data row1 col0" >-0.553455</td>
      <td id="T_798b9_row1_col1" class="data row1 col1" >-0.143252</td>
      <td id="T_798b9_row1_col2" class="data row1 col2" >-0.239338</td>
      <td id="T_798b9_row1_col3" class="data row1 col3" >0.311367</td>
      <td id="T_798b9_row1_col4" class="data row1 col4" >0.481236</td>
      <td id="T_798b9_row1_col5" class="data row1 col5" >-0.814254</td>
      <td id="T_798b9_row1_col6" class="data row1 col6" >0.317994</td>
      <td id="T_798b9_row1_col7" class="data row1 col7" >0.398657</td>
      <td id="T_798b9_row1_col8" class="data row1 col8" >1.000000</td>
      <td id="T_798b9_row1_col9" class="data row1 col9" >0.092909</td>
      <td id="T_798b9_row1_col10" class="data row1 col10" >0.954089</td>
      <td id="T_798b9_row1_col11" class="data row1 col11" >-0.014550</td>
    </tr>
    <tr>
      <th id="T_798b9_level0_row2" class="row_heading level0 row2" >swd_pct</th>
      <td id="T_798b9_row2_col0" class="data row2 col0" >-0.536632</td>
      <td id="T_798b9_row2_col1" class="data row2 col1" >-0.351879</td>
      <td id="T_798b9_row2_col2" class="data row2 col2" >-0.353346</td>
      <td id="T_798b9_row2_col3" class="data row2 col3" >0.136179</td>
      <td id="T_798b9_row2_col4" class="data row2 col4" >0.249781</td>
      <td id="T_798b9_row2_col5" class="data row2 col5" >-0.188203</td>
      <td id="T_798b9_row2_col6" class="data row2 col6" >1.000000</td>
      <td id="T_798b9_row2_col7" class="data row2 col7" >-0.023496</td>
      <td id="T_798b9_row2_col8" class="data row2 col8" >0.317994</td>
      <td id="T_798b9_row2_col9" class="data row2 col9" >-0.236692</td>
      <td id="T_798b9_row2_col10" class="data row2 col10" >0.380535</td>
      <td id="T_798b9_row2_col11" class="data row2 col11" >-0.165597</td>
    </tr>
    <tr>
      <th id="T_798b9_level0_row3" class="row_heading level0 row3" >hispanic_pct</th>
      <td id="T_798b9_row3_col0" class="data row3 col0" >-0.346844</td>
      <td id="T_798b9_row3_col1" class="data row3 col1" >-0.060650</td>
      <td id="T_798b9_row3_col2" class="data row3 col2" >-0.329082</td>
      <td id="T_798b9_row3_col3" class="data row3 col3" >-0.419924</td>
      <td id="T_798b9_row3_col4" class="data row3 col4" >1.000000</td>
      <td id="T_798b9_row3_col5" class="data row3 col5" >-0.372532</td>
      <td id="T_798b9_row3_col6" class="data row3 col6" >0.249781</td>
      <td id="T_798b9_row3_col7" class="data row3 col7" >0.491201</td>
      <td id="T_798b9_row3_col8" class="data row3 col8" >0.481236</td>
      <td id="T_798b9_row3_col9" class="data row3 col9" >-0.043585</td>
      <td id="T_798b9_row3_col10" class="data row3 col10" >0.532394</td>
      <td id="T_798b9_row3_col11" class="data row3 col11" >-0.258318</td>
    </tr>
    <tr>
      <th id="T_798b9_level0_row4" class="row_heading level0 row4" >ell_pct</th>
      <td id="T_798b9_row4_col0" class="data row4 col0" >-0.258410</td>
      <td id="T_798b9_row4_col1" class="data row4 col1" >0.078280</td>
      <td id="T_798b9_row4_col2" class="data row4 col2" >0.224635</td>
      <td id="T_798b9_row4_col3" class="data row4 col3" >-0.423411</td>
      <td id="T_798b9_row4_col4" class="data row4 col4" >0.491201</td>
      <td id="T_798b9_row4_col5" class="data row4 col5" >-0.199569</td>
      <td id="T_798b9_row4_col6" class="data row4 col6" >-0.023496</td>
      <td id="T_798b9_row4_col7" class="data row4 col7" >1.000000</td>
      <td id="T_798b9_row4_col8" class="data row4 col8" >0.398657</td>
      <td id="T_798b9_row4_col9" class="data row4 col9" >-0.231778</td>
      <td id="T_798b9_row4_col10" class="data row4 col10" >0.420963</td>
      <td id="T_798b9_row4_col11" class="data row4 col11" >0.049425</td>
    </tr>
    <tr>
      <th id="T_798b9_level0_row5" class="row_heading level0 row5" >black_pct</th>
      <td id="T_798b9_row5_col0" class="data row5 col0" >-0.235805</td>
      <td id="T_798b9_row5_col1" class="data row5 col1" >-0.281028</td>
      <td id="T_798b9_row5_col2" class="data row5 col2" >-0.459831</td>
      <td id="T_798b9_row5_col3" class="data row5 col3" >1.000000</td>
      <td id="T_798b9_row5_col4" class="data row5 col4" >-0.419924</td>
      <td id="T_798b9_row5_col5" class="data row5 col5" >-0.476618</td>
      <td id="T_798b9_row5_col6" class="data row5 col6" >0.136179</td>
      <td id="T_798b9_row5_col7" class="data row5 col7" >-0.423411</td>
      <td id="T_798b9_row5_col8" class="data row5 col8" >0.311367</td>
      <td id="T_798b9_row5_col9" class="data row5 col9" >0.324027</td>
      <td id="T_798b9_row5_col10" class="data row5 col10" >0.266915</td>
      <td id="T_798b9_row5_col11" class="data row5 col11" >-0.001906</td>
    </tr>
    <tr>
      <th id="T_798b9_level0_row6" class="row_heading level0 row6" >geo_district</th>
      <td id="T_798b9_row6_col0" class="data row6 col0" >0.011835</td>
      <td id="T_798b9_row6_col1" class="data row6 col1" >0.207157</td>
      <td id="T_798b9_row6_col2" class="data row6 col2" >0.274706</td>
      <td id="T_798b9_row6_col3" class="data row6 col3" >-0.001906</td>
      <td id="T_798b9_row6_col4" class="data row6 col4" >-0.258318</td>
      <td id="T_798b9_row6_col5" class="data row6 col5" >0.099406</td>
      <td id="T_798b9_row6_col6" class="data row6 col6" >-0.165597</td>
      <td id="T_798b9_row6_col7" class="data row6 col7" >0.049425</td>
      <td id="T_798b9_row6_col8" class="data row6 col8" >-0.014550</td>
      <td id="T_798b9_row6_col9" class="data row6 col9" >-0.124843</td>
      <td id="T_798b9_row6_col10" class="data row6 col10" >-0.129043</td>
      <td id="T_798b9_row6_col11" class="data row6 col11" >1.000000</td>
    </tr>
    <tr>
      <th id="T_798b9_level0_row7" class="row_heading level0 row7" >total_enrollment</th>
      <td id="T_798b9_row7_col0" class="data row7 col0" >0.288875</td>
      <td id="T_798b9_row7_col1" class="data row7 col1" >1.000000</td>
      <td id="T_798b9_row7_col2" class="data row7 col2" >0.354664</td>
      <td id="T_798b9_row7_col3" class="data row7 col3" >-0.281028</td>
      <td id="T_798b9_row7_col4" class="data row7 col4" >-0.060650</td>
      <td id="T_798b9_row7_col5" class="data row7 col5" >0.169663</td>
      <td id="T_798b9_row7_col6" class="data row7 col6" >-0.351879</td>
      <td id="T_798b9_row7_col7" class="data row7 col7" >0.078280</td>
      <td id="T_798b9_row7_col8" class="data row7 col8" >-0.143252</td>
      <td id="T_798b9_row7_col9" class="data row7 col9" >0.018803</td>
      <td id="T_798b9_row7_col10" class="data row7 col10" >-0.169468</td>
      <td id="T_798b9_row7_col11" class="data row7 col11" >0.207157</td>
    </tr>
    <tr>
      <th id="T_798b9_level0_row8" class="row_heading level0 row8" >charter</th>
      <td id="T_798b9_row8_col0" class="data row8 col0" >0.298770</td>
      <td id="T_798b9_row8_col1" class="data row8 col1" >0.018803</td>
      <td id="T_798b9_row8_col2" class="data row8 col2" >-0.226191</td>
      <td id="T_798b9_row8_col3" class="data row8 col3" >0.324027</td>
      <td id="T_798b9_row8_col4" class="data row8 col4" >-0.043585</td>
      <td id="T_798b9_row8_col5" class="data row8 col5" >-0.201707</td>
      <td id="T_798b9_row8_col6" class="data row8 col6" >-0.236692</td>
      <td id="T_798b9_row8_col7" class="data row8 col7" >-0.231778</td>
      <td id="T_798b9_row8_col8" class="data row8 col8" >0.092909</td>
      <td id="T_798b9_row8_col9" class="data row8 col9" >1.000000</td>
      <td id="T_798b9_row8_col10" class="data row8 col10" >0.048291</td>
      <td id="T_798b9_row8_col11" class="data row8 col11" >-0.124843</td>
    </tr>
    <tr>
      <th id="T_798b9_level0_row9" class="row_heading level0 row9" >asian_pct</th>
      <td id="T_798b9_row9_col0" class="data row9 col0" >0.382410</td>
      <td id="T_798b9_row9_col1" class="data row9 col1" >0.354664</td>
      <td id="T_798b9_row9_col2" class="data row9 col2" >1.000000</td>
      <td id="T_798b9_row9_col3" class="data row9 col3" >-0.459831</td>
      <td id="T_798b9_row9_col4" class="data row9 col4" >-0.329082</td>
      <td id="T_798b9_row9_col5" class="data row9 col5" >0.177453</td>
      <td id="T_798b9_row9_col6" class="data row9 col6" >-0.353346</td>
      <td id="T_798b9_row9_col7" class="data row9 col7" >0.224635</td>
      <td id="T_798b9_row9_col8" class="data row9 col8" >-0.239338</td>
      <td id="T_798b9_row9_col9" class="data row9 col9" >-0.226191</td>
      <td id="T_798b9_row9_col10" class="data row9 col10" >-0.263891</td>
      <td id="T_798b9_row9_col11" class="data row9 col11" >0.274706</td>
    </tr>
    <tr>
      <th id="T_798b9_level0_row10" class="row_heading level0 row10" >white_pct</th>
      <td id="T_798b9_row10_col0" class="data row10 col0" >0.423773</td>
      <td id="T_798b9_row10_col1" class="data row10 col1" >0.169663</td>
      <td id="T_798b9_row10_col2" class="data row10 col2" >0.177453</td>
      <td id="T_798b9_row10_col3" class="data row10 col3" >-0.476618</td>
      <td id="T_798b9_row10_col4" class="data row10 col4" >-0.372532</td>
      <td id="T_798b9_row10_col5" class="data row10 col5" >1.000000</td>
      <td id="T_798b9_row10_col6" class="data row10 col6" >-0.188203</td>
      <td id="T_798b9_row10_col7" class="data row10 col7" >-0.199569</td>
      <td id="T_798b9_row10_col8" class="data row10 col8" >-0.814254</td>
      <td id="T_798b9_row10_col9" class="data row10 col9" >-0.201707</td>
      <td id="T_798b9_row10_col10" class="data row10 col10" >-0.797134</td>
      <td id="T_798b9_row10_col11" class="data row10 col11" >0.099406</td>
    </tr>
    <tr>
      <th id="T_798b9_level0_row11" class="row_heading level0 row11" >mean_scale_score</th>
      <td id="T_798b9_row11_col0" class="data row11 col0" >1.000000</td>
      <td id="T_798b9_row11_col1" class="data row11 col1" >0.288875</td>
      <td id="T_798b9_row11_col2" class="data row11 col2" >0.382410</td>
      <td id="T_798b9_row11_col3" class="data row11 col3" >-0.235805</td>
      <td id="T_798b9_row11_col4" class="data row11 col4" >-0.346844</td>
      <td id="T_798b9_row11_col5" class="data row11 col5" >0.423773</td>
      <td id="T_798b9_row11_col6" class="data row11 col6" >-0.536632</td>
      <td id="T_798b9_row11_col7" class="data row11 col7" >-0.258410</td>
      <td id="T_798b9_row11_col8" class="data row11 col8" >-0.553455</td>
      <td id="T_798b9_row11_col9" class="data row11 col9" >0.298770</td>
      <td id="T_798b9_row11_col10" class="data row11 col10" >-0.587185</td>
      <td id="T_798b9_row11_col11" class="data row11 col11" >0.011835</td>
    </tr>
  </tbody>
</table>
</div><p><strong>Scatter plots of correlations showing covariance of factors</strong></p>
<img alt="../../_images/08-predictive-stats_5_3.png" src="../../_images/08-predictive-stats_5_3.png" />
</div>
</div>
</section>
</section>
<section id="ols-linear-regression-with-different-factors">
<h2>OLS Linear Regression with different factors<a class="headerlink" href="#ols-linear-regression-with-different-factors" title="Permalink to this headline">#</a></h2>
<p>We’re going to run a linear regression prediction with several different sets of factors to
see which combination creates the strongest predictive model.</p>
<p>Because the training and testing sets are randomized we will get slightly different results
each time we run the code in this cell. It appears that the factors that total enrollment has
no predictive power and that including poverty_pct without eni_pct produces slightly
better predictions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>

<span class="c1"># shuffle our data frame so test, train are randomized, but the same across runs</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># make a small function so that we can report r2 and mse for different factors</span>

<span class="k">def</span> <span class="nf">show_predict</span><span class="p">(</span><span class="n">factors</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">factors</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;mean_scale_score&#39;</span><span class="p">]</span>
    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">report</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">**</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">**</span>

<span class="s2">- factors: </span><span class="si">{</span><span class="n">factors</span><span class="si">}</span>
<span class="s2">- r2: </span><span class="si">{</span><span class="n">r2</span><span class="si">}</span>
<span class="s2">- rmse: </span><span class="si">{</span><span class="n">rmse</span><span class="si">}</span>
<span class="s2">&quot;&quot;&quot;</span>
    <span class="n">display</span><span class="p">(</span><span class="n">md</span><span class="p">(</span><span class="n">report</span><span class="p">))</span>

<span class="n">factors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;total_enrollment&#39;</span><span class="p">,</span> <span class="s1">&#39;asian_pct&#39;</span><span class="p">,</span><span class="s1">&#39;black_pct&#39;</span><span class="p">,</span> 
           <span class="s1">&#39;hispanic_pct&#39;</span><span class="p">,</span>  <span class="s1">&#39;white_pct&#39;</span><span class="p">,</span><span class="s1">&#39;swd_pct&#39;</span><span class="p">,</span> <span class="s1">&#39;ell_pct&#39;</span><span class="p">,</span>
           <span class="s1">&#39;poverty_pct&#39;</span><span class="p">,</span> <span class="s1">&#39;charter&#39;</span><span class="p">]</span>
<span class="n">show_predict</span><span class="p">(</span><span class="n">factors</span><span class="p">,</span> <span class="s2">&quot;With total enrollment&quot;</span><span class="p">)</span>

<span class="n">factors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;asian_pct&#39;</span><span class="p">,</span><span class="s1">&#39;black_pct&#39;</span><span class="p">,</span> 
       <span class="s1">&#39;hispanic_pct&#39;</span><span class="p">,</span>  <span class="s1">&#39;white_pct&#39;</span><span class="p">,</span><span class="s1">&#39;swd_pct&#39;</span><span class="p">,</span> <span class="s1">&#39;ell_pct&#39;</span><span class="p">,</span>  <span class="s1">&#39;poverty_pct&#39;</span><span class="p">,</span> <span class="s1">&#39;charter&#39;</span><span class="p">]</span>
<span class="n">show_predict</span><span class="p">(</span><span class="n">factors</span><span class="p">,</span> <span class="s2">&quot;Without total enrollment&quot;</span><span class="p">)</span>

<span class="n">factors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;asian_pct&#39;</span><span class="p">,</span><span class="s1">&#39;black_pct&#39;</span><span class="p">,</span> 
       <span class="s1">&#39;hispanic_pct&#39;</span><span class="p">,</span>  <span class="s1">&#39;white_pct&#39;</span><span class="p">,</span><span class="s1">&#39;swd_pct&#39;</span><span class="p">,</span> <span class="s1">&#39;ell_pct&#39;</span><span class="p">,</span>  <span class="s1">&#39;poverty_pct&#39;</span><span class="p">,</span> <span class="s1">&#39;eni_pct&#39;</span><span class="p">,</span> <span class="s1">&#39;charter&#39;</span><span class="p">]</span>
<span class="n">show_predict</span><span class="p">(</span><span class="n">factors</span><span class="p">,</span> <span class="s2">&quot;Adding ENI&quot;</span> <span class="p">)</span>


<span class="n">factors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;asian_pct&#39;</span><span class="p">,</span><span class="s1">&#39;black_pct&#39;</span><span class="p">,</span> 
       <span class="s1">&#39;hispanic_pct&#39;</span><span class="p">,</span>  <span class="s1">&#39;white_pct&#39;</span><span class="p">,</span><span class="s1">&#39;swd_pct&#39;</span><span class="p">,</span> <span class="s1">&#39;ell_pct&#39;</span><span class="p">,</span> <span class="s1">&#39;eni_pct&#39;</span><span class="p">,</span> <span class="s1">&#39;charter&#39;</span><span class="p">]</span>
<span class="n">show_predict</span><span class="p">(</span><span class="n">factors</span><span class="p">,</span> <span class="s2">&quot;ENI without Poverty %&quot;</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<p><strong>With total enrollment</strong></p>
<ul class="simple">
<li><p>factors: ['total_enrollment', 'asian_pct', 'black_pct', 'hispanic_pct', 'white_pct', 'swd_pct', 'ell_pct', 'poverty_pct', 'charter']</p></li>
<li><p>r2: 0.601374313079333</p></li>
<li><p>rmse: 7.144427248446355</p></li>
</ul>
<p><strong>Without total enrollment</strong></p>
<ul class="simple">
<li><p>factors: ['asian_pct', 'black_pct', 'hispanic_pct', 'white_pct', 'swd_pct', 'ell_pct', 'poverty_pct', 'charter']</p></li>
<li><p>r2: 0.6007831036093795</p></li>
<li><p>rmse: 7.149723304653924</p></li>
</ul>
<p><strong>Adding ENI</strong></p>
<ul class="simple">
<li><p>factors: ['asian_pct', 'black_pct', 'hispanic_pct', 'white_pct', 'swd_pct', 'ell_pct', 'poverty_pct', 'eni_pct', 'charter']</p></li>
<li><p>r2: 0.6018228807403438</p></li>
<li><p>rmse: 7.140406357169124</p></li>
</ul>
<p><strong>ENI without Poverty %</strong></p>
<ul class="simple">
<li><p>factors: ['asian_pct', 'black_pct', 'hispanic_pct', 'white_pct', 'swd_pct', 'ell_pct', 'eni_pct', 'charter']</p></li>
<li><p>r2: 0.6003977404133258</p></li>
<li><p>rmse: 7.153173278418023</p></li>
</ul>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="partial-least-squares">
<h1>Partial Least Squares<a class="headerlink" href="#partial-least-squares" title="Permalink to this headline">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">factors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;total_enrollment&#39;</span><span class="p">,</span> <span class="s1">&#39;asian_pct&#39;</span><span class="p">,</span><span class="s1">&#39;black_pct&#39;</span><span class="p">,</span> 
           <span class="s1">&#39;hispanic_pct&#39;</span><span class="p">,</span>  <span class="s1">&#39;white_pct&#39;</span><span class="p">,</span><span class="s1">&#39;swd_pct&#39;</span><span class="p">,</span> <span class="s1">&#39;ell_pct&#39;</span><span class="p">,</span>
           <span class="s1">&#39;poverty_pct&#39;</span><span class="p">,</span> <span class="s1">&#39;charter&#39;</span><span class="p">]</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">factors</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;mean_scale_score&#39;</span><span class="p">]</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">pls</span> <span class="o">=</span> <span class="n">PLSRegression</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">factors</span><span class="p">))</span>
<span class="n">pls</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>


<span class="n">predictions</span> <span class="o">=</span> <span class="n">pls</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span>
<span class="n">rmse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">md</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">**PLS predict**</span>

<span class="s2">- factors: </span><span class="si">{</span><span class="n">factors</span><span class="si">}</span>
<span class="s2">- r2: </span><span class="si">{</span><span class="n">r2</span><span class="si">}</span>
<span class="s2">- rmse: </span><span class="si">{</span><span class="n">rmse</span><span class="si">}</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<p><strong>PLS predict</strong></p>
<ul class="simple">
<li><p>factors: ['total_enrollment', 'asian_pct', 'black_pct', 'hispanic_pct', 'white_pct', 'swd_pct', 'ell_pct', 'poverty_pct', 'charter']</p></li>
<li><p>r2: 0.5999520630139812</p></li>
<li><p>rmse: 7.187062154262691</p></li>
</ul>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># fit both models with the full data and show the correlations</span>
<span class="n">ols_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">pls_fit</span> <span class="o">=</span> <span class="n">pls</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="n">coef_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;factor&quot;</span><span class="p">,</span> <span class="s2">&quot;pls-coef&quot;</span><span class="p">,</span> <span class="s2">&quot;ols-coef&quot;</span><span class="p">])</span>

<span class="n">coef_table</span><span class="o">.</span><span class="n">factor</span> <span class="o">=</span> <span class="n">factors</span>

<span class="n">coef_table</span><span class="p">[</span><span class="s2">&quot;pls-coef&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pls</span><span class="o">.</span><span class="n">coef_</span><span class="p">]</span>
<span class="n">coef_table</span><span class="p">[</span><span class="s2">&quot;ols-coef&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">coef_</span><span class="p">]</span>

<span class="c1"># coef_table.join(ols_df, on=&quot;factor&quot;)</span>
<span class="n">coef_table</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/mxc/.virtualenvs/school-data/lib/python3.10/site-packages/sklearn/cross_decomposition/_pls.py:503: FutureWarning: The attribute `coef_` will be transposed in version 1.3 to be consistent with other linear models in scikit-learn. Currently, `coef_` has a shape of (n_features, n_targets) and in the future it will have a shape of (n_targets, n_features).
  warnings.warn(
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>factor</th>
      <th>pls-coef</th>
      <th>ols-coef</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>total_enrollment</td>
      <td>0.292540</td>
      <td>0.000905</td>
    </tr>
    <tr>
      <th>1</th>
      <td>asian_pct</td>
      <td>3.938312</td>
      <td>22.357730</td>
    </tr>
    <tr>
      <th>2</th>
      <td>black_pct</td>
      <td>-0.235673</td>
      <td>-0.838275</td>
    </tr>
    <tr>
      <th>3</th>
      <td>hispanic_pct</td>
      <td>1.332454</td>
      <td>5.186641</td>
    </tr>
    <tr>
      <th>4</th>
      <td>white_pct</td>
      <td>1.870359</td>
      <td>9.845927</td>
    </tr>
    <tr>
      <th>5</th>
      <td>swd_pct</td>
      <td>-2.729158</td>
      <td>-39.616177</td>
    </tr>
    <tr>
      <th>6</th>
      <td>ell_pct</td>
      <td>-2.200350</td>
      <td>-18.667367</td>
    </tr>
    <tr>
      <th>7</th>
      <td>poverty_pct</td>
      <td>-2.956922</td>
      <td>-14.384679</td>
    </tr>
    <tr>
      <th>8</th>
      <td>charter</td>
      <td>3.905203</td>
      <td>10.371978</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># compare sklearn and statsmodel OLS</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;mean_scale_score&#39;</span><span class="p">]</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">factors</span><span class="p">]</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">sm_ols</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="n">params</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sm_ols</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
<span class="n">coefs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sm_ols</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">:],)</span>
<span class="n">pvalues</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sm_ols</span><span class="o">.</span><span class="n">pvalues</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
<span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">coefs</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">pvalues</span><span class="p">)</span>
<span class="n">pvalues</span>
<span class="n">ols_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;factor&quot;</span><span class="p">:</span><span class="n">params</span><span class="p">,</span><span class="s2">&quot;sm-coef&quot;</span><span class="p">:</span><span class="n">coefs</span><span class="p">,</span><span class="s2">&quot;p-values&quot;</span><span class="p">:</span><span class="n">pvalues</span><span class="p">})</span>
<span class="c1"># ols_df</span>
<span class="n">coef_table</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">ols_df</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="s2">&quot;factor&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>factor</th>
      <th>pls-coef</th>
      <th>ols-coef</th>
      <th>sm-coef</th>
      <th>p-values</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>total_enrollment</td>
      <td>0.292540</td>
      <td>0.000905</td>
      <td>0.000905</td>
      <td>4.759245e-03</td>
    </tr>
    <tr>
      <th>1</th>
      <td>asian_pct</td>
      <td>3.938312</td>
      <td>22.357730</td>
      <td>22.357730</td>
      <td>4.136083e-08</td>
    </tr>
    <tr>
      <th>2</th>
      <td>black_pct</td>
      <td>-0.235673</td>
      <td>-0.838275</td>
      <td>-0.838275</td>
      <td>8.343130e-01</td>
    </tr>
    <tr>
      <th>3</th>
      <td>hispanic_pct</td>
      <td>1.332454</td>
      <td>5.186641</td>
      <td>5.186641</td>
      <td>1.930317e-01</td>
    </tr>
    <tr>
      <th>4</th>
      <td>white_pct</td>
      <td>1.870359</td>
      <td>9.845927</td>
      <td>9.845927</td>
      <td>1.196722e-02</td>
    </tr>
    <tr>
      <th>5</th>
      <td>swd_pct</td>
      <td>-2.729158</td>
      <td>-39.616177</td>
      <td>-39.616177</td>
      <td>2.500699e-119</td>
    </tr>
    <tr>
      <th>6</th>
      <td>ell_pct</td>
      <td>-2.200350</td>
      <td>-18.667367</td>
      <td>-18.667367</td>
      <td>5.892349e-59</td>
    </tr>
    <tr>
      <th>7</th>
      <td>poverty_pct</td>
      <td>-2.956922</td>
      <td>-14.384679</td>
      <td>-14.384679</td>
      <td>5.709181e-46</td>
    </tr>
    <tr>
      <th>8</th>
      <td>charter</td>
      <td>3.905203</td>
      <td>10.371978</td>
      <td>10.371978</td>
      <td>4.740549e-265</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># let&#39;s get p-values for the sklearn models</span>
<span class="n">pls_intercept</span> <span class="o">=</span> <span class="n">y_intercept</span> <span class="o">=</span> <span class="n">pls_fit</span><span class="o">.</span><span class="n">_y_mean</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">pls_fit</span><span class="o">.</span><span class="n">_x_mean</span> <span class="p">,</span> <span class="n">pls_fit</span><span class="o">.</span><span class="n">coef_</span><span class="p">)</span>
<span class="n">pls_intercept</span> <span class="o">=</span> <span class="n">pls_intercept</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">pls_intercept</span>
<span class="n">pls_coef</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pls</span><span class="o">.</span><span class="n">coef_</span><span class="p">]</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">factors</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;mean_scale_score&#39;</span><span class="p">]</span>
<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>


<span class="n">beta_hat</span> <span class="o">=</span> <span class="p">[</span><span class="n">pls_intercept</span><span class="p">]</span> <span class="o">+</span> <span class="n">pls_coef</span>
<span class="n">beta_hat</span>


<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">t</span>
<span class="n">X1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">X</span><span class="p">))</span>
<span class="c1"># standard deviation of the noise.</span>
<span class="n">sigma_hat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">X1</span><span class="nd">@beta_hat</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">X1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="c1"># estimate the covariance matrix for beta </span>
<span class="n">beta_cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">X1</span><span class="o">.</span><span class="n">T</span><span class="nd">@X1</span><span class="p">)</span>
<span class="c1"># the t-test statistic for each variable from the formula from above figure</span>
<span class="n">t_vals</span> <span class="o">=</span> <span class="n">beta_hat</span> <span class="o">/</span> <span class="p">(</span><span class="n">sigma_hat</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diagonal</span><span class="p">(</span><span class="n">beta_cov</span><span class="p">)))</span>
<span class="c1"># compute 2-sided p-values.</span>
<span class="n">p_vals</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t_vals</span><span class="p">),</span> <span class="n">n</span><span class="o">-</span><span class="n">X1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="mi">2</span> 
<span class="n">t_vals</span>
<span class="c1"># array([ 0.37424023, -2.36373529,  3.57930174])</span>
<span class="n">p_vals</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([2.07183903e-19, 0.00000000e+00, 9.40071536e-01, 9.96353400e-01,
       9.79264969e-01, 9.70396004e-01, 8.98851951e-01, 8.80842705e-01,
       8.18668445e-01, 2.84814328e-01])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">md</span><span class="p">(</span><span class="s2">&quot;### Graph of PLS coefficients&quot;</span><span class="p">))</span>
<span class="n">coefs</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pls</span><span class="o">.</span><span class="n">coef_</span><span class="p">]</span>
<span class="n">ui</span><span class="o">.</span><span class="n">network_map</span><span class="p">(</span><span class="s2">&quot;mean_scale_score&quot;</span><span class="p">,</span> <span class="n">factors</span><span class="p">,</span> <span class="n">coefs</span> <span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">md</span><span class="p">(</span><span class="s2">&quot;### Graph of OLS coefficients&quot;</span><span class="p">))</span>
<span class="n">coefs</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">coef_</span><span class="p">]</span>
<span class="n">ui</span><span class="o">.</span><span class="n">network_map</span><span class="p">(</span><span class="s2">&quot;mean_scale_score&quot;</span><span class="p">,</span> <span class="n">factors</span><span class="p">,</span> <span class="n">coefs</span> <span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<span class="docutils literal">/home/mxc/Projects/school-data-portal/book/nb/04-Statistics/08-predictive-stats.ipynb</span>, line 1)</p>
<p>Non-consecutive header level increase; 0 to 3 [myst.header]</p>
</div>
<img alt="../../_images/08-predictive-stats_13_1.png" src="../../_images/08-predictive-stats_13_1.png" />
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<span class="docutils literal">/home/mxc/Projects/school-data-portal/book/nb/04-Statistics/08-predictive-stats.ipynb</span>, line 1)</p>
<p>Non-consecutive header level increase; 0 to 3 [myst.header]</p>
</div>
<img alt="../../_images/08-predictive-stats_13_3.png" src="../../_images/08-predictive-stats_13_3.png" />
</div>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./nb/04-Statistics"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="05-anova-ols.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">ANOVA and OLS Regression</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../05-Maps-and-GIS/01-maps-intro.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Introduction to Maps and Spatial Data</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Matthew X. Curinga, Taye Johnson, Kavindra Sahabir, Robert Wilcox<br/>
  
    <div class="extra_footer">
      <p xmlns:cc="http://creativecommons.org/ns#" xmlns:dct="http://purl.org/dc/terms/"><a property="dct:title" rel="cc:attributionURL" href="https://adelphi-ed-tech.github.io/nycschools/">NYC Schools Open Data Portal</a> is licensed under <a href="http://creativecommons.org/licenses/by-sa/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">CC BY-SA 4.0<img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1"><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1"><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/sa.svg?ref=chooser-v1"></a></p> 

    </div>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>