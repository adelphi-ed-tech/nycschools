<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2. T-Test comparing test scores for charter and public schools &mdash; NYC Schools Open Data 0.1.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script src="../../_static/custom.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> NYC Schools Open Data
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../01-Basics/index.html">1. Data Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02-Combining-Data/index.html">Combining Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03-Graphs-and-Charts/index.html">Graphs &amp; Charts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../04-Statistics/index.html">Statistics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../05-Maps-and-GIS/index.html">2. Maps &amp; GIS</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../data-sources.html">Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/nycschools.html">API Docs</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">NYC Schools Open Data</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a></li>
      <li class="breadcrumb-item active"><span class="section-number">2. </span>T-Test comparing test scores for charter and public schools</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/nb/_archive/charter-vs-community.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars and line breaks on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
    white-space: pre;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="k">as</span> <span class="nn">scipy</span>
<span class="kn">import</span> <span class="nn">pingouin</span> <span class="k">as</span> <span class="nn">pg</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">from</span> <span class="nn">statsmodels.formula.api</span> <span class="kn">import</span> <span class="n">ols</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Markdown</span> <span class="k">as</span> <span class="n">md</span>


<span class="kn">from</span> <span class="nn">school_data</span> <span class="kn">import</span> <span class="n">schools</span><span class="p">,</span> <span class="n">exams</span><span class="p">,</span> <span class="n">ui</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
The autoreload extension is already loaded. To reload it, use:
  %reload_ext autoreload
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">demo</span> <span class="o">=</span> <span class="n">schools</span><span class="o">.</span><span class="n">load_school_demographics</span><span class="p">()</span>
<span class="n">tests</span> <span class="o">=</span> <span class="n">exams</span><span class="o">.</span><span class="n">load_math_ela_long</span><span class="p">()</span>
<span class="n">demo</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>dbn</th>
      <th>beds</th>
      <th>district</th>
      <th>boro</th>
      <th>school_name</th>
      <th>short_name</th>
      <th>ay</th>
      <th>year</th>
      <th>total_enrollment</th>
      <th>grade_3k_pk_half_day_full</th>
      <th>...</th>
      <th>missing_race_ethnicity_data_pct</th>
      <th>swd_n</th>
      <th>swd_pct</th>
      <th>ell_n</th>
      <th>ell_pct</th>
      <th>poverty_n</th>
      <th>poverty_pct</th>
      <th>eni_pct</th>
      <th>clean_name</th>
      <th>zip</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>01M015</td>
      <td>310100010015</td>
      <td>1</td>
      <td>Manhattan</td>
      <td>P.S. 015 Roberto Clemente</td>
      <td>PS 15</td>
      <td>2016</td>
      <td>2016-17</td>
      <td>178</td>
      <td>17</td>
      <td>...</td>
      <td>0.000000</td>
      <td>51</td>
      <td>0.287000</td>
      <td>12</td>
      <td>0.067</td>
      <td>152</td>
      <td>0.854</td>
      <td>0.882</td>
      <td>roberto clemente</td>
      <td>10009</td>
    </tr>
    <tr>
      <th>1</th>
      <td>01M015</td>
      <td>310100010015</td>
      <td>1</td>
      <td>Manhattan</td>
      <td>P.S. 015 Roberto Clemente</td>
      <td>PS 15</td>
      <td>2017</td>
      <td>2017-18</td>
      <td>190</td>
      <td>17</td>
      <td>...</td>
      <td>0.000000</td>
      <td>49</td>
      <td>0.258000</td>
      <td>8</td>
      <td>0.042</td>
      <td>161</td>
      <td>0.847</td>
      <td>0.890</td>
      <td>roberto clemente</td>
      <td>10009</td>
    </tr>
    <tr>
      <th>2</th>
      <td>01M015</td>
      <td>310100010015</td>
      <td>1</td>
      <td>Manhattan</td>
      <td>P.S. 015 Roberto Clemente</td>
      <td>PS 15</td>
      <td>2018</td>
      <td>2018-19</td>
      <td>174</td>
      <td>13</td>
      <td>...</td>
      <td>0.000000</td>
      <td>39</td>
      <td>0.224000</td>
      <td>8</td>
      <td>0.046</td>
      <td>147</td>
      <td>0.845</td>
      <td>0.888</td>
      <td>roberto clemente</td>
      <td>10009</td>
    </tr>
    <tr>
      <th>3</th>
      <td>01M015</td>
      <td>310100010015</td>
      <td>1</td>
      <td>Manhattan</td>
      <td>P.S. 015 Roberto Clemente</td>
      <td>PS 15</td>
      <td>2019</td>
      <td>2019-20</td>
      <td>190</td>
      <td>14</td>
      <td>...</td>
      <td>0.000000</td>
      <td>46</td>
      <td>0.242000</td>
      <td>17</td>
      <td>0.089</td>
      <td>155</td>
      <td>0.816</td>
      <td>0.867</td>
      <td>roberto clemente</td>
      <td>10009</td>
    </tr>
    <tr>
      <th>4</th>
      <td>01M015</td>
      <td>310100010015</td>
      <td>1</td>
      <td>Manhattan</td>
      <td>P.S. 015 Roberto Clemente</td>
      <td>PS 15</td>
      <td>2020</td>
      <td>2020-21</td>
      <td>193</td>
      <td>17</td>
      <td>...</td>
      <td>0.000000</td>
      <td>43</td>
      <td>0.223000</td>
      <td>21</td>
      <td>0.109</td>
      <td>158</td>
      <td>0.819</td>
      <td>0.856</td>
      <td>roberto clemente</td>
      <td>10009</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>9996</th>
      <td>84X730</td>
      <td>320800860846</td>
      <td>84</td>
      <td>Bronx</td>
      <td>Bronx Charter School for the Arts</td>
      <td>PS 730</td>
      <td>2016</td>
      <td>2016-17</td>
      <td>320</td>
      <td>0</td>
      <td>...</td>
      <td>0.000000</td>
      <td>67</td>
      <td>0.209375</td>
      <td>51</td>
      <td>0.159</td>
      <td>235</td>
      <td>0.734</td>
      <td>0.840</td>
      <td>bronx charter school for the arts</td>
      <td>10474</td>
    </tr>
    <tr>
      <th>9997</th>
      <td>84X730</td>
      <td>320800860846</td>
      <td>84</td>
      <td>Bronx</td>
      <td>Bronx Charter School for the Arts</td>
      <td>PS 730</td>
      <td>2017</td>
      <td>2017-18</td>
      <td>314</td>
      <td>0</td>
      <td>...</td>
      <td>0.000000</td>
      <td>68</td>
      <td>0.216561</td>
      <td>57</td>
      <td>0.182</td>
      <td>258</td>
      <td>0.822</td>
      <td>0.891</td>
      <td>bronx charter school for the arts</td>
      <td>10474</td>
    </tr>
    <tr>
      <th>9998</th>
      <td>84X730</td>
      <td>320800860846</td>
      <td>84</td>
      <td>Bronx</td>
      <td>Bronx Charter School for the Arts</td>
      <td>PS 730</td>
      <td>2018</td>
      <td>2018-19</td>
      <td>430</td>
      <td>0</td>
      <td>...</td>
      <td>0.000000</td>
      <td>103</td>
      <td>0.239535</td>
      <td>71</td>
      <td>0.165</td>
      <td>363</td>
      <td>0.844</td>
      <td>0.888</td>
      <td>bronx charter school for the arts</td>
      <td>10474</td>
    </tr>
    <tr>
      <th>9999</th>
      <td>84X730</td>
      <td>320800860846</td>
      <td>84</td>
      <td>Bronx</td>
      <td>Bronx Charter School for the Arts</td>
      <td>MS 730</td>
      <td>2019</td>
      <td>2019-20</td>
      <td>523</td>
      <td>0</td>
      <td>...</td>
      <td>0.000000</td>
      <td>117</td>
      <td>0.223709</td>
      <td>69</td>
      <td>0.132</td>
      <td>453</td>
      <td>0.866</td>
      <td>0.892</td>
      <td>bronx charter school for the arts</td>
      <td>10474</td>
    </tr>
    <tr>
      <th>10000</th>
      <td>84X730</td>
      <td>320800860846</td>
      <td>84</td>
      <td>Bronx</td>
      <td>Bronx Charter School for the Arts</td>
      <td>MS 730</td>
      <td>2020</td>
      <td>2020-21</td>
      <td>626</td>
      <td>0</td>
      <td>...</td>
      <td>0.001597</td>
      <td>153</td>
      <td>0.244409</td>
      <td>78</td>
      <td>0.125</td>
      <td>541</td>
      <td>0.864</td>
      <td>0.882</td>
      <td>bronx charter school for the arts</td>
      <td>10474</td>
    </tr>
  </tbody>
</table>
<p>10001 rows × 50 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">demo</span><span class="p">[</span><span class="n">schools</span><span class="o">.</span><span class="n">demo</span><span class="o">.</span><span class="n">core_cols</span><span class="p">]</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">tests</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;dbn&quot;</span><span class="p">,</span> <span class="s2">&quot;ay&quot;</span><span class="p">])</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">mean_scale_score</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span>
<span class="c1"># they changed the test scoring in 2017, so can&#39;t really be compared to earlier years</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">ay</span> <span class="o">&gt;</span> <span class="mi">2016</span><span class="p">]</span>

<span class="c1"># use the district code for charter, and make an int rather than boolean</span>
<span class="c1"># df.charter = df.district.apply(lambda x: 1 if x == 84 else 0)</span>
<span class="n">df</span><span class="o">.</span><span class="n">charter</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
102       False
103       False
104       False
105       False
109       False
          ...
420126     True
420127     True
420128     True
420129     True
420130     True
Name: charter, Length: 222010, dtype: bool
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># T test</span>
<span class="n">pub</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;charter == 0 and district &lt;= 32&quot;</span><span class="p">)</span>
<span class="n">charter</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;charter == 1&quot;</span><span class="p">)</span>

<span class="n">t</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span><span class="n">pub</span><span class="p">[</span><span class="s2">&quot;mean_scale_score&quot;</span><span class="p">],</span> <span class="n">charter</span><span class="p">[</span><span class="s2">&quot;mean_scale_score&quot;</span><span class="p">])</span>
<br/></pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><br/><span></span><span class="c1"># print(sa.dbn.unique())</span>
<span class="c1"># print(charter.dbn.unique())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;charter schools with tests&quot;</span><span class="p">,</span> <span class="n">charter</span><span class="o">.</span><span class="n">dbn</span><span class="o">.</span><span class="n">nunique</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;charter schools with demo&quot;</span><span class="p">,</span> <span class="n">demo</span><span class="p">[</span><span class="n">demo</span><span class="o">.</span><span class="n">district</span> <span class="o">==</span> <span class="mi">84</span><span class="p">]</span><span class="o">.</span><span class="n">dbn</span><span class="o">.</span><span class="n">nunique</span><span class="p">())</span>
<span class="n">demo_charters</span> <span class="o">=</span> <span class="n">demo</span><span class="p">[(</span><span class="n">demo</span><span class="o">.</span><span class="n">district</span> <span class="o">==</span> <span class="mi">84</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">demo</span><span class="o">.</span><span class="n">ay</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">2017</span><span class="p">,</span> <span class="mi">2018</span><span class="p">]))]</span>
<span class="n">charter_dbns</span> <span class="o">=</span> <span class="n">charter</span><span class="o">.</span><span class="n">dbn</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="n">demo_charters</span><span class="p">[</span><span class="o">~</span><span class="n">demo_charters</span><span class="o">.</span><span class="n">dbn</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">charter_dbns</span><span class="p">)][[</span><span class="s2">&quot;dbn&quot;</span><span class="p">,</span><span class="s2">&quot;school_name&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
charter schools with tests 191
charter schools with demo 267
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>dbn</th>
      <th>district</th>
      <th>boro</th>
      <th>school_name</th>
      <th>ay</th>
      <th>total_enrollment</th>
      <th>asian_n</th>
      <th>asian_pct</th>
      <th>black_n</th>
      <th>black_pct</th>
      <th>...</th>
      <th>level_2_pct</th>
      <th>level_3_n</th>
      <th>level_3_pct</th>
      <th>level_4_n</th>
      <th>level_4_pct</th>
      <th>level_3_4_n</th>
      <th>level_3_4_pct</th>
      <th>test_year</th>
      <th>charter</th>
      <th>exam</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>382701</th>
      <td>84K125</td>
      <td>84</td>
      <td>Brooklyn</td>
      <td>Success Academy Charter School - Bed-Stuy 2</td>
      <td>2017</td>
      <td>339</td>
      <td>4</td>
      <td>0.012000</td>
      <td>220</td>
      <td>0.649000</td>
      <td>...</td>
      <td>2.7</td>
      <td>14.0</td>
      <td>19.2</td>
      <td>56.0</td>
      <td>76.7</td>
      <td>70.0</td>
      <td>95.9</td>
      <td>2018</td>
      <td>1</td>
      <td>math</td>
    </tr>
    <tr>
      <th>382702</th>
      <td>84K125</td>
      <td>84</td>
      <td>Brooklyn</td>
      <td>Success Academy Charter School - Bed-Stuy 2</td>
      <td>2017</td>
      <td>339</td>
      <td>4</td>
      <td>0.012000</td>
      <td>220</td>
      <td>0.649000</td>
      <td>...</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>5.7</td>
      <td>66.0</td>
      <td>94.3</td>
      <td>70.0</td>
      <td>100.0</td>
      <td>2018</td>
      <td>1</td>
      <td>math</td>
    </tr>
    <tr>
      <th>382703</th>
      <td>84K125</td>
      <td>84</td>
      <td>Brooklyn</td>
      <td>Success Academy Charter School - Bed-Stuy 2</td>
      <td>2017</td>
      <td>339</td>
      <td>4</td>
      <td>0.012000</td>
      <td>220</td>
      <td>0.649000</td>
      <td>...</td>
      <td>1.4</td>
      <td>18.0</td>
      <td>12.6</td>
      <td>122.0</td>
      <td>85.3</td>
      <td>140.0</td>
      <td>97.9</td>
      <td>2018</td>
      <td>1</td>
      <td>math</td>
    </tr>
    <tr>
      <th>382704</th>
      <td>84K125</td>
      <td>84</td>
      <td>Brooklyn</td>
      <td>Success Academy Charter School - Bed-Stuy 2</td>
      <td>2017</td>
      <td>339</td>
      <td>4</td>
      <td>0.012000</td>
      <td>220</td>
      <td>0.649000</td>
      <td>...</td>
      <td>6.8</td>
      <td>50.0</td>
      <td>68.5</td>
      <td>18.0</td>
      <td>24.7</td>
      <td>68.0</td>
      <td>93.2</td>
      <td>2018</td>
      <td>1</td>
      <td>ela</td>
    </tr>
    <tr>
      <th>382705</th>
      <td>84K125</td>
      <td>84</td>
      <td>Brooklyn</td>
      <td>Success Academy Charter School - Bed-Stuy 2</td>
      <td>2017</td>
      <td>339</td>
      <td>4</td>
      <td>0.012000</td>
      <td>220</td>
      <td>0.649000</td>
      <td>...</td>
      <td>12.9</td>
      <td>35.0</td>
      <td>50.0</td>
      <td>26.0</td>
      <td>37.1</td>
      <td>61.0</td>
      <td>87.1</td>
      <td>2018</td>
      <td>1</td>
      <td>ela</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>387819</th>
      <td>84X494</td>
      <td>84</td>
      <td>Bronx</td>
      <td>Success Academy Charter School - Bronx 2</td>
      <td>2018</td>
      <td>757</td>
      <td>7</td>
      <td>0.009247</td>
      <td>476</td>
      <td>0.628798</td>
      <td>...</td>
      <td>20.8</td>
      <td>46.0</td>
      <td>45.5</td>
      <td>34.0</td>
      <td>33.7</td>
      <td>80.0</td>
      <td>79.2</td>
      <td>2019</td>
      <td>1</td>
      <td>ela</td>
    </tr>
    <tr>
      <th>387820</th>
      <td>84X494</td>
      <td>84</td>
      <td>Bronx</td>
      <td>Success Academy Charter School - Bronx 2</td>
      <td>2018</td>
      <td>757</td>
      <td>7</td>
      <td>0.009247</td>
      <td>476</td>
      <td>0.628798</td>
      <td>...</td>
      <td>0.0</td>
      <td>13.0</td>
      <td>21.3</td>
      <td>48.0</td>
      <td>78.7</td>
      <td>61.0</td>
      <td>100.0</td>
      <td>2019</td>
      <td>1</td>
      <td>ela</td>
    </tr>
    <tr>
      <th>387821</th>
      <td>84X494</td>
      <td>84</td>
      <td>Bronx</td>
      <td>Success Academy Charter School - Bronx 2</td>
      <td>2018</td>
      <td>757</td>
      <td>7</td>
      <td>0.009247</td>
      <td>476</td>
      <td>0.628798</td>
      <td>...</td>
      <td>1.8</td>
      <td>24.0</td>
      <td>42.1</td>
      <td>32.0</td>
      <td>56.1</td>
      <td>56.0</td>
      <td>98.2</td>
      <td>2019</td>
      <td>1</td>
      <td>ela</td>
    </tr>
    <tr>
      <th>387822</th>
      <td>84X494</td>
      <td>84</td>
      <td>Bronx</td>
      <td>Success Academy Charter School - Bronx 2</td>
      <td>2018</td>
      <td>757</td>
      <td>7</td>
      <td>0.009247</td>
      <td>476</td>
      <td>0.628798</td>
      <td>...</td>
      <td>0.0</td>
      <td>8.0</td>
      <td>15.1</td>
      <td>45.0</td>
      <td>84.9</td>
      <td>53.0</td>
      <td>100.0</td>
      <td>2019</td>
      <td>1</td>
      <td>ela</td>
    </tr>
    <tr>
      <th>387823</th>
      <td>84X494</td>
      <td>84</td>
      <td>Bronx</td>
      <td>Success Academy Charter School - Bronx 2</td>
      <td>2018</td>
      <td>757</td>
      <td>7</td>
      <td>0.009247</td>
      <td>476</td>
      <td>0.628798</td>
      <td>...</td>
      <td>9.1</td>
      <td>219.0</td>
      <td>47.5</td>
      <td>198.0</td>
      <td>43.0</td>
      <td>417.0</td>
      <td>90.5</td>
      <td>2019</td>
      <td>1</td>
      <td>ela</td>
    </tr>
  </tbody>
</table>
<p>453 rows × 39 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[61]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># success academy</span>
<span class="n">sa</span> <span class="o">=</span> <span class="n">schools</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">demo</span><span class="p">,</span> <span class="s2">&quot;success academy&quot;</span><span class="p">)</span>
<span class="n">success</span> <span class="o">=</span> <span class="n">charter</span><span class="p">[</span><span class="n">charter</span><span class="o">.</span><span class="n">dbn</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">sa</span><span class="o">.</span><span class="n">dbn</span><span class="p">)]</span>
<span class="n">other_charter</span> <span class="o">=</span> <span class="n">charter</span><span class="p">[</span><span class="o">~</span><span class="n">charter</span><span class="o">.</span><span class="n">dbn</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">sa</span><span class="o">.</span><span class="n">dbn</span><span class="p">)]</span>
<span class="n">t</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span><span class="n">other_charter</span><span class="p">[</span><span class="s2">&quot;mean_scale_score&quot;</span><span class="p">],</span> <span class="n">success</span><span class="p">[</span><span class="s2">&quot;mean_scale_score&quot;</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="n">success</span><span class="o">.</span><span class="n">mean_scale_score</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">other_charter</span><span class="o">.</span><span class="n">mean_scale_score</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>

<span class="n">success</span><span class="o">.</span><span class="n">dbn</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
622.4194260485651 604.1729569093611
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[61]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
28
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">md</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">T-Test comparing test scores for charter and public schools</span>
<span class="s2">------------------------------------------------------------</span>
<span class="s2">T-Test results comparing average math and ELA test scores for academic years </span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">ay</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">ay</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">.</span>
<span class="s2">Data includes the mean average test score for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">charter</span><span class="p">[</span><span class="s2">&quot;dbn&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> charter schools</span>
<span class="s2">and </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pub</span><span class="p">[</span><span class="s2">&quot;dbn&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> community schools.</span>

<span class="s2">~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<span class="s2">  Charter schools: M=</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">charter</span><span class="p">[</span><span class="s2">&quot;mean_scale_score&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">, SD=</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">charter</span><span class="p">[</span><span class="s2">&quot;mean_scale_score&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span>
<span class="s2">Community schools: M=</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">pub</span><span class="p">[</span><span class="s2">&quot;mean_scale_score&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">, SD=</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">pub</span><span class="p">[</span><span class="s2">&quot;mean_scale_score&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span>
<span class="s2">          T-score: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">, p-val: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="si">}</span>
<span class="s2">~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<section id="T-Test-comparing-test-scores-for-charter-and-public-schools">
<h1><span class="section-number">2. </span>T-Test comparing test scores for charter and public schools<a class="headerlink" href="#T-Test-comparing-test-scores-for-charter-and-public-schools" title="Permalink to this heading"></a></h1>
<p>T-Test results comparing average math and ELA test scores for academic years 2017-2018. Data includes the mean average test score for 191 charter schools and 1,114 community schools.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  Charter schools: M=606.34, SD=9.41
Community schools: M=598.86, SD=11.85
          T-score: -38.78, p-val: 0.0
</pre></div>
</div>
</section>
</div>
</div>
<section id="Why-do-charter-school-students-score-higher-on-NYS-exams?">
<h1><span class="section-number">2. </span>Why do charter school students score higher on NYS exams?<a class="headerlink" href="#Why-do-charter-school-students-score-higher-on-NYS-exams?" title="Permalink to this heading"></a></h1>
<p>We can interpret these results to understand that the higher mean test scores for charter schools is statistically significant (p&lt;.01). The t-test doesn’t offer insight into <em>why</em> charters produce higher test scores. In the academic and popular literature surrounding schools, though, several hypothesis have been forwarded to explain the difference in scores:</p>
<ul class="simple">
<li><p>charter schools are more rigorous: they have better instructional methods, faculty, and/or leadership</p></li>
<li><p>charters teach (more) to the test than community schools</p></li>
<li><p>charter schools “council out” students who aren’t doing well academically</p></li>
<li><p>charter schools don’t enroll students with IEPs (in special education) and/or English learners</p></li>
<li><p>charter school families are self-selecting because they <em>chose</em> to attend charters</p></li>
<li><p>charters are better funded: they receive the same funding as community schools <em>and</em> have backing from the wealthiest corporate backers in the world (Walton family, Gates Foundation, etc)</p></li>
</ul>
<p>In the next sections we will see if our data can help understand which of these factors better explain the test results.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">agg</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;dbn&quot;</span><span class="p">:</span><span class="s2">&quot;count&quot;</span><span class="p">,</span>
    <span class="s2">&quot;total_enrollment&quot;</span><span class="p">:[</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span><span class="s2">&quot;mean&quot;</span><span class="p">],</span>
    <span class="s2">&quot;mean_scale_score&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;min&quot;</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">]</span>
<span class="p">}</span>
<span class="n">table</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;charter&quot;</span><span class="p">,</span> <span class="s2">&quot;ay&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">agg</span><span class="p">)</span>
<span class="n">table</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">counts</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;charter&quot;</span><span class="p">,</span> <span class="s2">&quot;ay&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">dbn</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
<span class="n">counts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span>
<span class="n">counts</span> <span class="o">=</span> <span class="n">counts</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">table</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;ay&quot;</span><span class="p">,</span><span class="s2">&quot;charter&quot;</span><span class="p">])</span>

<span class="n">table</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_flat_index</span><span class="p">()</span>

<span class="n">table</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;School Type&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Year&quot;</span><span class="p">,</span>
    <span class="s2">&quot;No. Schools&quot;</span><span class="p">,</span>
    <span class="s2">&quot;No. Students&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Avg School Size&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Test Score (mean)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Test Score (min)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Test Score (max)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Test Score (stand. deviation)&quot;</span><span class="p">]</span>
<span class="n">table</span><span class="p">[</span><span class="s2">&quot;School Type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;School Type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="mi">1</span><span class="p">:</span><span class="s2">&quot;charter&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="s2">&quot;public&quot;</span><span class="p">})</span>
<span class="n">table</span><span class="o">.</span><span class="n">columns</span>
<span class="n">ui</span><span class="o">.</span><span class="n">fmt_table</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="n">num_cols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;No. Schools&#39;</span><span class="p">,</span> <span class="s1">&#39;No. Students&#39;</span><span class="p">,</span> <span class="s1">&#39;Avg School Size&#39;</span><span class="p">,</span>
       <span class="s1">&#39;Test Score (mean)&#39;</span><span class="p">,</span> <span class="s1">&#39;Test Score (min)&#39;</span><span class="p">,</span> <span class="s1">&#39;Test Score (max)&#39;</span><span class="p">,</span>
       <span class="s1">&#39;Test Score (stand. deviation)&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/tmp/ipykernel_47513/1164761851.py:11: FutureWarning: merging between different levels is deprecated and will be removed in a future version. (2 levels on the left, 1 on the right)
  table.merge(counts,how=&#34;inner&#34;, on=[&#34;ay&#34;,&#34;charter&#34;])
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>School Type</th>
      <th>Year</th>
      <th>No. Schools</th>
      <th>No. Students</th>
      <th>Avg School Size</th>
      <th>Test Score (mean)</th>
      <th>Test Score (min)</th>
      <th>Test Score (max)</th>
      <th>Test Score (stand. deviation)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>public</td>
      <td>2017</td>
      <td>99,651</td>
      <td>66,238,091</td>
      <td>664.701</td>
      <td>598.862</td>
      <td>555.143</td>
      <td>646.833</td>
      <td>11.844</td>
    </tr>
    <tr>
      <th>1</th>
      <td>public</td>
      <td>2018</td>
      <td>101,219</td>
      <td>65,880,164</td>
      <td>650.868</td>
      <td>598.849</td>
      <td>553.25</td>
      <td>645.875</td>
      <td>11.857</td>
    </tr>
    <tr>
      <th>2</th>
      <td>charter</td>
      <td>2017</td>
      <td>1,849</td>
      <td>1,124,769</td>
      <td>608.312</td>
      <td>606.325</td>
      <td>577.0</td>
      <td>638.0</td>
      <td>9.3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>charter</td>
      <td>2018</td>
      <td>1,969</td>
      <td>1,211,955</td>
      <td>615.518</td>
      <td>606.35</td>
      <td>575.0</td>
      <td>639.0</td>
      <td>9.507</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">make_pretty</span><span class="p">(</span><span class="n">styler</span><span class="p">):</span>
    <span class="n">styler</span><span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s2">&quot;Demographics: public vs. charter schools&quot;</span><span class="p">)</span>
    <span class="n">styler</span><span class="o">.</span><span class="n">background_gradient</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;coolwarm&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">styler</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># T test</span>


<span class="k">def</span> <span class="nf">get_t</span><span class="p">(</span><span class="n">col</span><span class="p">):</span>
    <span class="n">t</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span><span class="n">pub</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">charter</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
    <span class="n">pub_avg</span> <span class="o">=</span> <span class="n">pub</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">charter_avg</span> <span class="o">=</span> <span class="n">charter</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span>
        <span class="s2">&quot;% public&quot;</span><span class="p">:</span> <span class="n">pub_avg</span><span class="p">,</span>
        <span class="s2">&quot;</span><span class="si">% c</span><span class="s2">harter&quot;</span><span class="p">:</span> <span class="n">charter_avg</span><span class="p">,</span>
        <span class="s2">&quot;</span><span class="si">% d</span><span class="s2">iff&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">charter_avg</span> <span class="o">-</span> <span class="n">pub_avg</span><span class="p">)</span> <span class="o">/</span> <span class="n">pub_avg</span><span class="p">,</span>
        <span class="s2">&quot;t-score&quot;</span><span class="p">:</span> <span class="n">t</span><span class="p">,</span>
        <span class="s2">&quot;p-value&quot;</span><span class="p">:</span> <span class="n">p</span>
    <span class="p">}</span>
<span class="n">factors</span> <span class="o">=</span> <span class="p">[</span> <span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">pub</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_pct&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">)]</span>

<span class="c1"># this is what we get for factors</span>
<span class="c1"># factors = [&#39;asian_pct&#39;,</span>
<span class="c1">#  &#39;black_pct&#39;,</span>
<span class="c1">#  &#39;hispanic_pct&#39;,</span>
<span class="c1">#  &#39;white_pct&#39;,</span>
<span class="c1">#  &#39;swd_pct&#39;,</span>
<span class="c1">#  &#39;ell_pct&#39;,</span>
<span class="c1">#  &#39;poverty_pct&#39;]</span>

<span class="n">factor_t_scores</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_t</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">factors</span><span class="p">]</span>
<span class="n">table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">factor_t_scores</span><span class="p">)</span>
<span class="n">table</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">% d</span><span class="s2">iff&quot;</span><span class="p">)</span>

<span class="n">ui</span><span class="o">.</span><span class="n">fmt_table</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">pct_cols</span><span class="o">=</span><span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span> <span class="n">num_cols</span><span class="o">=</span><span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>category</th>
      <th>% public</th>
      <th>% charter</th>
      <th>% diff</th>
      <th>t-score</th>
      <th>p-value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Asian</td>
      <td>15.0%</td>
      <td>2.8%</td>
      <td>-81.1%</td>
      <td>39.39</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>White</td>
      <td>15.6%</td>
      <td>4.6%</td>
      <td>-70.9%</td>
      <td>33.612</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Ell</td>
      <td>14.5%</td>
      <td>7.0%</td>
      <td>-51.6%</td>
      <td>40.507</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Swd</td>
      <td>21.5%</td>
      <td>17.3%</td>
      <td>-19.8%</td>
      <td>39.876</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Hispanic</td>
      <td>42.2%</td>
      <td>38.4%</td>
      <td>-9.0%</td>
      <td>9.041</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Eni</td>
      <td>72.0%</td>
      <td>75.3%</td>
      <td>4.6%</td>
      <td>-9.181</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Poverty</td>
      <td>75.4%</td>
      <td>80.7%</td>
      <td>7.1%</td>
      <td>-15.529</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Black</td>
      <td>24.6%</td>
      <td>52.1%</td>
      <td>111.6%</td>
      <td>-66.069</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">factors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;asian_pct&#39;</span><span class="p">,</span>
 <span class="s1">&#39;black_pct&#39;</span><span class="p">,</span>
 <span class="s1">&#39;hispanic_pct&#39;</span><span class="p">,</span>
 <span class="s1">&#39;white_pct&#39;</span><span class="p">,</span>
 <span class="s1">&#39;swd_pct&#39;</span><span class="p">,</span>
 <span class="s1">&#39;ell_pct&#39;</span><span class="p">,</span>
 <span class="s1">&#39;poverty_pct&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</section>
<section id="Charters-serve-a-different-population">
<h1><span class="section-number">3. </span>Charters serve a different population<a class="headerlink" href="#Charters-serve-a-different-population" title="Permalink to this heading"></a></h1>
<p>The table above shows us that charter schools serve a completely different population than public schools. The clear difference is that charter school students are more than twice as likely to be Black as public school students. Accordingly, every other racial/ethinic group is greater in percentage in public schools. Most markedly for Asian and White students, but still statistically significant for Hispanic students with 42.2% Hispanic in public schools and 38.4% in charters
(<code class="docutils literal notranslate"><span class="pre">t(204687)</span> <span class="pre">=</span> <span class="pre">9.041,</span> <span class="pre">p</span> <span class="pre">&lt;</span> <span class="pre">.01</span></code>).</p>
<p>As noted as a possible explanation for higher test scores in charter schools, they serve statistically significant (p&lt;.01) lower percentage of ELL students and stdents with disabilities, with English Learners are twice as likely to be in a public school as a charter school.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># easily make a grouped bar chart with built-in dataframe function</span>
<span class="n">charter_dbn</span> <span class="o">=</span> <span class="n">charter</span><span class="o">.</span><span class="n">dbn</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="n">charter_dbn</span>
<span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;dbn&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">factors</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">demo</span><span class="p">[</span><span class="n">demo</span><span class="o">.</span><span class="n">ay</span> <span class="o">==</span> <span class="mi">2020</span><span class="p">][</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">chart</span><span class="p">[</span><span class="s2">&quot;school_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">chart</span><span class="o">.</span><span class="n">dbn</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">dbn</span><span class="p">:</span><span class="s2">&quot;charter&quot;</span> <span class="k">if</span> <span class="n">dbn</span> <span class="ow">in</span> <span class="n">charter_dbn</span> <span class="k">else</span> <span class="s2">&quot;public&quot;</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">chart</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;school_type&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="s2">&quot;mean&quot;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s2">&quot;public&quot;</span><span class="p">,</span> <span class="s2">&quot;charter&quot;</span><span class="p">])</span>
<span class="c1"># plt.text(0,x=0,y=0,ha=&quot;center&quot;)</span>

<span class="n">data</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>school_type</th>
      <th>asian_pct</th>
      <th>black_pct</th>
      <th>hispanic_pct</th>
      <th>white_pct</th>
      <th>swd_pct</th>
      <th>ell_pct</th>
      <th>poverty_pct</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>charter</td>
      <td>0.032559</td>
      <td>0.498250</td>
      <td>0.396218</td>
      <td>0.047024</td>
      <td>0.178096</td>
      <td>0.077382</td>
      <td>0.793649</td>
    </tr>
    <tr>
      <th>1</th>
      <td>public</td>
      <td>0.126209</td>
      <td>0.279912</td>
      <td>0.439771</td>
      <td>0.124737</td>
      <td>0.242648</td>
      <td>0.147952</td>
      <td>0.764373</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/nb__archive_charter-vs-community_13_1.png" src="../../_images/nb__archive_charter-vs-community_13_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># problem is, we can&#39;t see side-by-side for charter vs public</span>
<span class="c1"># let&#39;s melt the data to make it easier</span>
<span class="c1"># pandas makes the group clusters based on rows with the values coming from the columns</span>

<span class="c1"># melt the public data into a new df and then group it to get the means in each category</span>
<span class="n">pub</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;school_type == &#39;public&#39;&quot;</span><span class="p">),</span> <span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;dbn&quot;</span><span class="p">,</span> <span class="s2">&quot;school_type&quot;</span><span class="p">],</span> <span class="n">value_vars</span><span class="o">=</span><span class="n">factors</span><span class="p">,</span> <span class="n">var_name</span><span class="o">=</span><span class="s2">&quot;demo_cat&quot;</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">&quot;public&quot;</span><span class="p">)</span>
<span class="n">pub</span> <span class="o">=</span> <span class="n">pub</span><span class="p">[[</span><span class="s2">&quot;demo_cat&quot;</span><span class="p">,</span> <span class="s2">&quot;public&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;demo_cat&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="s2">&quot;mean&quot;</span><span class="p">)</span>

<span class="c1"># do the same for the charter data</span>
<span class="n">charter</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;school_type == &#39;charter&#39;&quot;</span><span class="p">),</span> <span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;dbn&quot;</span><span class="p">,</span> <span class="s2">&quot;school_type&quot;</span><span class="p">],</span> <span class="n">value_vars</span><span class="o">=</span><span class="n">factors</span><span class="p">,</span> <span class="n">var_name</span><span class="o">=</span><span class="s2">&quot;demo_cat&quot;</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">&quot;charter&quot;</span><span class="p">)</span>
<span class="n">charter</span> <span class="o">=</span> <span class="n">charter</span><span class="p">[[</span><span class="s2">&quot;demo_cat&quot;</span><span class="p">,</span> <span class="s2">&quot;charter&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;demo_cat&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="s2">&quot;mean&quot;</span><span class="p">)</span>

<span class="c1"># join them back into a single dataframe for our chart</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pub</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">charter</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;demo_cat&quot;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># make the percents 0-100 rather than 0-1</span>
<span class="n">data</span><span class="o">.</span><span class="n">public</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">public</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">data</span><span class="o">.</span><span class="n">charter</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">charter</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<span class="c1"># plot the chart and get the axis so we can set titles and stuff</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">9</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">])</span>

<span class="c1"># we could set these by hand if we wanted to</span>
<span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;% </span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">demo_cat</span><span class="p">]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">titles</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Percent of students&quot;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Charter vs Public School Demographic Groups&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;#DDDDDD&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_axisbelow</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#efefef&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="s1">&#39;talk&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=-</span><span class="mi">45</span><span class="p">)</span>
<span class="k">pass</span>

<span class="n">data</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>demo_cat</th>
      <th>public</th>
      <th>charter</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>asian_pct</td>
      <td>12.6</td>
      <td>3.3</td>
    </tr>
    <tr>
      <th>1</th>
      <td>black_pct</td>
      <td>28.0</td>
      <td>49.8</td>
    </tr>
    <tr>
      <th>2</th>
      <td>ell_pct</td>
      <td>14.8</td>
      <td>7.7</td>
    </tr>
    <tr>
      <th>3</th>
      <td>hispanic_pct</td>
      <td>44.0</td>
      <td>39.6</td>
    </tr>
    <tr>
      <th>4</th>
      <td>poverty_pct</td>
      <td>76.4</td>
      <td>79.4</td>
    </tr>
    <tr>
      <th>5</th>
      <td>swd_pct</td>
      <td>24.3</td>
      <td>17.8</td>
    </tr>
    <tr>
      <th>6</th>
      <td>white_pct</td>
      <td>12.5</td>
      <td>4.7</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/nb__archive_charter-vs-community_14_1.png" src="../../_images/nb__archive_charter-vs-community_14_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">show_ols</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
    <span class="n">factors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;total_enrollment&#39;</span><span class="p">,</span> <span class="s1">&#39;asian_pct&#39;</span><span class="p">,</span>  <span class="s1">&#39;black_pct&#39;</span><span class="p">,</span>
       <span class="s1">&#39;hispanic_pct&#39;</span><span class="p">,</span>  <span class="s1">&#39;white_pct&#39;</span><span class="p">,</span><span class="s1">&#39;swd_pct&#39;</span><span class="p">,</span>  <span class="s1">&#39;ell_pct&#39;</span><span class="p">,</span>  <span class="s1">&#39;poverty_pct&#39;</span><span class="p">]</span>


    <span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;mean_scale_score&#39;</span><span class="p">]</span>

    <span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">factors</span><span class="p">]</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

    <span class="n">display</span><span class="p">(</span><span class="n">md</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;### </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>
    <span class="n">display</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>

    <span class="n">ui</span><span class="o">.</span><span class="n">plot_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>



<span class="n">pub</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;charter == 0 and district &lt;= 32&quot;</span><span class="p">)</span>
<span class="n">charter</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;charter == 1&quot;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;category == &#39;All Students&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">show_ols</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="s2">&quot;Linear Regression: public schools&quot;</span><span class="p">)</span>
<span class="n">show_ols</span><span class="p">(</span><span class="n">charter</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="s2">&quot;Linear Regression: charter schools&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<section id="Linear-Regression:-public-schools">
<h2><span class="section-number">2. </span>Linear Regression: public schools<a class="headerlink" href="#Linear-Regression:-public-schools" title="Permalink to this heading"></a></h2>
</section>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>    <td>mean_scale_score</td> <th>  R-squared:         </th> <td>   0.561</td>
</tr>
<tr>
  <th>Model:</th>                   <td>OLS</td>       <th>  Adj. R-squared:    </th> <td>   0.561</td>
</tr>
<tr>
  <th>Method:</th>             <td>Least Squares</td>  <th>  F-statistic:       </th> <td>   3657.</td>
</tr>
<tr>
  <th>Date:</th>             <td>Mon, 25 Apr 2022</td> <th>  Prob (F-statistic):</th>  <td>  0.00</td>
</tr>
<tr>
  <th>Time:</th>                 <td>18:35:40</td>     <th>  Log-Likelihood:    </th> <td> -77083.</td>
</tr>
<tr>
  <th>No. Observations:</th>      <td> 22876</td>      <th>  AIC:               </th> <td>1.542e+05</td>
</tr>
<tr>
  <th>Df Residuals:</th>          <td> 22867</td>      <th>  BIC:               </th> <td>1.543e+05</td>
</tr>
<tr>
  <th>Df Model:</th>              <td>     8</td>      <th>                     </th>     <td> </td>
</tr>
<tr>
  <th>Covariance Type:</th>      <td>nonrobust</td>    <th>                     </th>     <td> </td>
</tr>
</table>
<table class="simpletable">
<tr>
          <td></td>            <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>
</tr>
<tr>
  <th>const</th>            <td>  611.0904</td> <td>    1.860</td> <td>  328.488</td> <td> 0.000</td> <td>  607.444</td> <td>  614.737</td>
</tr>
<tr>
  <th>total_enrollment</th> <td>    0.0006</td> <td>    0.000</td> <td>    3.768</td> <td> 0.000</td> <td>    0.000</td> <td>    0.001</td>
</tr>
<tr>
  <th>asian_pct</th>        <td>   27.8467</td> <td>    2.083</td> <td>   13.366</td> <td> 0.000</td> <td>   23.763</td> <td>   31.930</td>
</tr>
<tr>
  <th>black_pct</th>        <td>   11.9563</td> <td>    2.040</td> <td>    5.860</td> <td> 0.000</td> <td>    7.957</td> <td>   15.955</td>
</tr>
<tr>
  <th>hispanic_pct</th>     <td>   17.4398</td> <td>    2.027</td> <td>    8.605</td> <td> 0.000</td> <td>   13.467</td> <td>   21.412</td>
</tr>
<tr>
  <th>white_pct</th>        <td>   17.1005</td> <td>    1.990</td> <td>    8.591</td> <td> 0.000</td> <td>   13.199</td> <td>   21.002</td>
</tr>
<tr>
  <th>swd_pct</th>          <td>  -53.7340</td> <td>    0.789</td> <td>  -68.075</td> <td> 0.000</td> <td>  -55.281</td> <td>  -52.187</td>
</tr>
<tr>
  <th>ell_pct</th>          <td>  -27.6419</td> <td>    0.607</td> <td>  -45.506</td> <td> 0.000</td> <td>  -28.833</td> <td>  -26.451</td>
</tr>
<tr>
  <th>poverty_pct</th>      <td>  -16.2563</td> <td>    0.506</td> <td>  -32.147</td> <td> 0.000</td> <td>  -17.247</td> <td>  -15.265</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Omnibus:</th>       <td>2132.756</td> <th>  Durbin-Watson:     </th> <td>   0.611</td>
</tr>
<tr>
  <th>Prob(Omnibus):</th>  <td> 0.000</td>  <th>  Jarque-Bera (JB):  </th> <td>4547.149</td>
</tr>
<tr>
  <th>Skew:</th>           <td> 0.599</td>  <th>  Prob(JB):          </th> <td>    0.00</td>
</tr>
<tr>
  <th>Kurtosis:</th>       <td> 4.826</td>  <th>  Cond. No.          </th> <td>6.68e+04</td>
</tr>
</table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.<br/>[2] The condition number is large, 6.68e+04. This might indicate that there are<br/>strong multicollinearity or other numerical problems.</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/nb__archive_charter-vs-community_15_2.png" src="../../_images/nb__archive_charter-vs-community_15_2.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<section id="Linear-Regression:-charter-schools">
<h2><span class="section-number">2. </span>Linear Regression: charter schools<a class="headerlink" href="#Linear-Regression:-charter-schools" title="Permalink to this heading"></a></h2>
</section>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>    <td>mean_scale_score</td> <th>  R-squared:         </th> <td>   0.254</td>
</tr>
<tr>
  <th>Model:</th>                   <td>OLS</td>       <th>  Adj. R-squared:    </th> <td>   0.253</td>
</tr>
<tr>
  <th>Method:</th>             <td>Least Squares</td>  <th>  F-statistic:       </th> <td>   162.4</td>
</tr>
<tr>
  <th>Date:</th>             <td>Mon, 25 Apr 2022</td> <th>  Prob (F-statistic):</th> <td>3.22e-236</td>
</tr>
<tr>
  <th>Time:</th>                 <td>18:35:40</td>     <th>  Log-Likelihood:    </th> <td> -13414.</td>
</tr>
<tr>
  <th>No. Observations:</th>      <td>  3818</td>      <th>  AIC:               </th> <td>2.685e+04</td>
</tr>
<tr>
  <th>Df Residuals:</th>          <td>  3809</td>      <th>  BIC:               </th> <td>2.690e+04</td>
</tr>
<tr>
  <th>Df Model:</th>              <td>     8</td>      <th>                     </th>     <td> </td>
</tr>
<tr>
  <th>Covariance Type:</th>      <td>nonrobust</td>    <th>                     </th>     <td> </td>
</tr>
</table>
<table class="simpletable">
<tr>
          <td></td>            <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>
</tr>
<tr>
  <th>const</th>            <td>  634.0868</td> <td>    9.036</td> <td>   70.170</td> <td> 0.000</td> <td>  616.370</td> <td>  651.804</td>
</tr>
<tr>
  <th>total_enrollment</th> <td>    0.0060</td> <td>    0.000</td> <td>   12.293</td> <td> 0.000</td> <td>    0.005</td> <td>    0.007</td>
</tr>
<tr>
  <th>asian_pct</th>        <td>    6.3804</td> <td>   10.166</td> <td>    0.628</td> <td> 0.530</td> <td>  -13.552</td> <td>   26.313</td>
</tr>
<tr>
  <th>black_pct</th>        <td>   -6.4510</td> <td>    9.645</td> <td>   -0.669</td> <td> 0.504</td> <td>  -25.362</td> <td>   12.460</td>
</tr>
<tr>
  <th>hispanic_pct</th>     <td>    1.8186</td> <td>    9.525</td> <td>    0.191</td> <td> 0.849</td> <td>  -16.855</td> <td>   20.492</td>
</tr>
<tr>
  <th>white_pct</th>        <td>  -15.6179</td> <td>   10.080</td> <td>   -1.549</td> <td> 0.121</td> <td>  -35.381</td> <td>    4.145</td>
</tr>
<tr>
  <th>swd_pct</th>          <td>  -56.9569</td> <td>    2.188</td> <td>  -26.032</td> <td> 0.000</td> <td>  -61.247</td> <td>  -52.667</td>
</tr>
<tr>
  <th>ell_pct</th>          <td>  -31.3858</td> <td>    3.503</td> <td>   -8.958</td> <td> 0.000</td> <td>  -38.255</td> <td>  -24.517</td>
</tr>
<tr>
  <th>poverty_pct</th>      <td>  -20.0756</td> <td>    2.060</td> <td>   -9.744</td> <td> 0.000</td> <td>  -24.115</td> <td>  -16.036</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Omnibus:</th>       <td>329.980</td> <th>  Durbin-Watson:     </th> <td>   0.541</td>
</tr>
<tr>
  <th>Prob(Omnibus):</th> <td> 0.000</td>  <th>  Jarque-Bera (JB):  </th> <td> 420.987</td>
</tr>
<tr>
  <th>Skew:</th>          <td> 0.770</td>  <th>  Prob(JB):          </th> <td>3.83e-92</td>
</tr>
<tr>
  <th>Kurtosis:</th>      <td> 3.521</td>  <th>  Cond. No.          </th> <td>1.09e+05</td>
</tr>
</table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.<br/>[2] The condition number is large, 1.09e+05. This might indicate that there are<br/>strong multicollinearity or other numerical problems.</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/nb__archive_charter-vs-community_15_5.png" src="../../_images/nb__archive_charter-vs-community_15_5.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pub</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;category == &#39;All Students&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">factors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;total_enrollment&#39;</span><span class="p">,</span> <span class="s1">&#39;asian_pct&#39;</span><span class="p">,</span>  <span class="s1">&#39;black_pct&#39;</span><span class="p">,</span>
   <span class="s1">&#39;hispanic_pct&#39;</span><span class="p">,</span>  <span class="s1">&#39;white_pct&#39;</span><span class="p">,</span><span class="s1">&#39;swd_pct&#39;</span><span class="p">,</span>  <span class="s1">&#39;ell_pct&#39;</span><span class="p">,</span>  <span class="s1">&#39;poverty_pct&#39;</span><span class="p">]</span>


<span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;mean_scale_score&#39;</span><span class="p">]</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">factors</span><span class="p">]</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>

<span class="n">cmap</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">seismic</span>
<span class="c1"># get the data we need from model</span>
<span class="n">dv</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">endog_names</span>

<span class="n">params</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
<span class="n">coefs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">:],)</span>
<span class="n">pvalues</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">pvalues</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

<span class="n">nodes</span> <span class="o">=</span>  <span class="n">params</span> <span class="o">+</span> <span class="p">[</span><span class="n">dv</span><span class="p">]</span>
<span class="n">plabels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;p=</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pvalues</span><span class="p">]</span>
<span class="n">pnodes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">plabels</span><span class="p">,</span> <span class="n">params</span><span class="p">))</span>

<span class="c1"># all targets point to the dv</span>
<span class="n">targets</span> <span class="o">=</span>  <span class="p">[</span><span class="n">dv</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">))]</span>
<span class="n">edges</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">targets</span><span class="p">))</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">coefs</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">weights</span> <span class="o">=</span>  <span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">coefs</span><span class="p">]</span>
<span class="n">weighted_edges</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">weights</span><span class="p">))</span>

<span class="n">max_node</span> <span class="o">=</span> <span class="mi">2000</span>
<span class="n">max_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
<span class="n">node_size</span> <span class="o">=</span> <span class="p">[</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">max_node</span> <span class="o">*</span> <span class="p">(</span><span class="n">c</span><span class="o">/</span><span class="n">max_size</span><span class="p">))</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">weights</span><span class="p">]</span>
<span class="n">node_size</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>  <span class="n">max_node</span> <span class="o">*</span> <span class="mi">2</span> <span class="p">)</span>

<span class="n">labels</span> <span class="o">=</span>  <span class="nb">dict</span><span class="p">([(</span><span class="n">n</span><span class="p">,</span> <span class="n">ui</span><span class="o">.</span><span class="n">nice_name</span><span class="p">(</span><span class="n">n</span><span class="p">))</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">])</span>

<span class="n">edge_labels</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">x</span><span class="p">,</span> <span class="n">ui</span><span class="o">.</span><span class="n">edge_label</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">coefs</span><span class="p">)])</span>
<span class="n">pnodes</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[(&#39;p=0.0&#39;, &#39;total_enrollment&#39;),
 (&#39;p=0.0&#39;, &#39;asian_pct&#39;),
 (&#39;p=0.096&#39;, &#39;black_pct&#39;),
 (&#39;p=0.02&#39;, &#39;hispanic_pct&#39;),
 (&#39;p=0.0&#39;, &#39;white_pct&#39;),
 (&#39;p=0.0&#39;, &#39;swd_pct&#39;),
 (&#39;p=0.0&#39;, &#39;ell_pct&#39;),
 (&#39;p=0.0&#39;, &#39;poverty_pct&#39;)]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">edges</span> <span class="o">=</span> <span class="n">weighted_edges</span>
<span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>
<span class="n">G</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>
<span class="n">G</span><span class="o">.</span><span class="n">add_weighted_edges_from</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>

<span class="c1"># pos = nx.spring_layout(G, k=3)</span>
<span class="n">pos</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">circular_layout</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>

<span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="n">node_size</span><span class="p">,</span>
        <span class="n">linewidths</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">min_source_margin</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">min_target_margin</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edge_labels</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">edge_labels</span><span class="o">=</span><span class="n">edge_labels</span><span class="p">,</span> <span class="n">label_pos</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="c1"># adding p-values as node</span>
<span class="n">G</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">(</span><span class="n">pnodes</span><span class="p">,</span> <span class="n">pval</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">pv_nodes</span> <span class="o">=</span>  <span class="n">nx</span><span class="o">.</span><span class="n">get_node_attributes</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="s2">&quot;pval&quot;</span><span class="p">)</span>
<span class="c1"># nx.draw_networkx_nodes(G, pos, ax=ax, nodelist=pv_nodes)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">pv_nodes</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{(&#39;p=0.0&#39;, &#39;total_enrollment&#39;): True, (&#39;p=0.0&#39;, &#39;asian_pct&#39;): True, (&#39;p=0.096&#39;, &#39;black_pct&#39;): True, (&#39;p=0.02&#39;, &#39;hispanic_pct&#39;): True, (&#39;p=0.0&#39;, &#39;white_pct&#39;): True, (&#39;p=0.0&#39;, &#39;swd_pct&#39;): True, (&#39;p=0.0&#39;, &#39;ell_pct&#39;): True, (&#39;p=0.0&#39;, &#39;poverty_pct&#39;): True}
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/nb__archive_charter-vs-community_18_1.png" src="../../_images/nb__archive_charter-vs-community_18_1.png" />
</div>
</div>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Matthew X. Curinga.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>